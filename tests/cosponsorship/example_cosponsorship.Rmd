---
title: "Bipartite application: Cosponsorship in the Senate"
author: "Adeline Lo"
date: "Latest version: December 2020"
output: 
  html_document: 
    pandoc_args: ["--lua-filter=color-text.lua"]
    toc: true
    toc_float: true
    number_sections: true
    theme: flatly
  pdf_document: 
    pandoc_args: ["--lua-filter=color-text.lua"]
    keep_tex: true
---
<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{cat, engine.opts = list(file = "color-text.lua")}
Span = function(span)
  color = span.attributes['color']
  -- if no color attribute, return unchange
  if color == nil then return span end
  
  -- tranform to <span style="color: red;"></span>
  if FORMAT:match 'html' then
    -- remove color attributes
    span.attributes['color'] = nil
    -- use style attribute instead
    span.attributes['style'] = 'color: ' .. color .. ';'
    -- return full span element
    return span
  elseif FORMAT:match 'latex' then
    -- remove color attributes
    span.attributes['color'] = nil
    -- encapsulate in latex code
    table.insert(
      span.content, 1,
      pandoc.RawInline('latex', '\\textcolor{'..color..'}{')
    )
    table.insert(
      span.content,
      pandoc.RawInline('latex', '}')
    )
    -- returns only span content
    return span.content
  else
    -- for other format return unchanged
    return span
  end
end
```

<!-- #possible themes: cerulean, journal, flatly,darkly,readable,spacelab,united,cosmo,lumen,paper,sandstone,simplex,yeti -->
```{css, echo=FALSE}
.pretty {
  background-color: white;
  border: 3px solid blue;
  font-weight: bold;
  font-family: Courier;
}
```

```{r setup, include=FALSE, eval=TRUE, echo=FALSE,message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#rm(list=ls())
library(bipartite)
library(corrplot)
library(dplyr)
library(ggplot2)
library(grid)
library(gridExtra)
library(hrbrthemes)
library(igraph)
library(kableExtra)
library(NetMix)
library(knitr)
library(reshape2)
library(sm) #kernel density plots
library(stringr)
library(Ternary)
library(viridis)
library(xtable)
```

# 107th Congressional session

**Notes:**

* On November 4, 2002, Jesse Ventura appointed Dean Barkley to complete the Senate term of Paul Wellstone, who died in a plane crash on October 25. The appointment was announced during the Senate debate between Republican Norm Coleman and Democrat Walter Mondale, who had taken Wellstone's place on the ballot; Ventura intended to upstage the debate. Barkley served until the 107th United States Congress ended on January 3, 2003, when he was replaced by Coleman, who won the election. --> 101 Senators counted in this session in total
* Lisa Ann Murkowski: replaced Frank Murkowski. She was appointed to the U.S. Senate by her father, who resigned his seat in December 2002 to become the Governor of Alaska. She completed her father's unexpired term, which ended in January 2005. She does not appear in the `SH.csv` dataset under congressional session 107 and so is omitted.

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE}
## Call in the data ##
dyad.data<-readRDS("cosponsor_data/dyad-data-107.rds")
senate<-readRDS("cosponsor_data/senate-107.rds")
bills<-readRDS("cosponsor_data/bills-107.rds")
bills<-subset(bills, select = -c(Minor,Major) )
node1=nrow(senate)
node2=nrow(bills)
```

Summarizing information on the Congress:

* Number of Democrats, Republicans
* Number of bills

```{r summary-stat107, echo=FALSE, eval=TRUE}
d<-cbind(subset(senate,select=c(labels),subset=party=="Democrat")[1:25,],subset(senate,select=c(labels),subset=party=="Democrat")[26:50,],subset(senate,select=c(labels),subset=party=="Republican")[1:25,],subset(senate,select=c(labels),subset=party=="Republican")[26:50,])
#names(d)<-c("Democrat","Democrat","Republican","Republican")
rownames(d)<-NULL
 kable(d, format="latex", booktabs = T, linesep = "",caption = "Senators in 107th Congressional Session. Notes: On November 4, 2002, Jesse Ventura appointed Dean Barkley to complete the Senate term of Paul Wellstone, who died in a plane crash on October 25. The appointment was announced during the Senate debate between Republican Norm Coleman and Democrat Walter Mondale, who had taken Wellstone's place on the ballot; Ventura intended to upstage the debate. Barkley served until the 107th United States Congress ended on January 3, 2003, when he was replaced by Coleman, who won the election. Lisa Ann Murkowski replaced Frank Murkowski. She was appointed to the U.S. Senate by her father, who resigned his seat in December 2002 to become the Governor of Alaska. She completed her father's unexpired term, which ended in January 2005. She does not appear in the congressional bills dataset under session 107 and so is omitted.", label="senators107") %>% 
   add_header_above(c("Democrats" = 2, "Republicans" = 2), font_size=12) %>%
   kable_styling(font_size=8, position="center"
                 ,bootstrap_options = "striped") %>%
   column_spec(1:2, width = "12em", bold = FALSE, italic = FALSE, color = "demblue") %>%
   column_spec(3:4, width = "12em", bold = FALSE, italic = FALSE, color = "repred") #%>%
  #footnote(general = "",threeparttable = T)
 
 #bills: table in latex (generated using tablesgenerator.com)
 table(bills$billsponsor_party,bills$billtype)
```

## Estimate the Model

We will be using three data sets

1) `dyad.data`: dyadic level data which is time-dyad level data, with variables for node index for senators (`node1`) and bills (`node2`) the edge value drawn between senator and bill nodes (`Y`), and the time period (here always 1, as we focus on the 107th congressional session only).

2) `senate`: monadic level data measured at the senator-time level, with a variable indicating the node index for senators (`node1`) which directly corresponds with the unique node index for senators in `dyad.data`. The same is true for the `time` variable. Monadic covariates include `seniority`, `ideol1`, `ideol2`, `party`, and `sex`.

3) `bills`: monadic level data measured at the bills-time level, with a variable indicating the node index for senators (`node2`) which directly corresponds with the unique node index for bills in `dyad.data`. The same is true for the `time` variable. Monadic covariates include `private`, `Major` and `Major2` (and `Major3` for alternative variable for classification of bill), as well as covariates on the sponsor of the bill (`billsponsor_seniority`, `billsponsor_ideol1`, `billsponsor_ideol2`, `billsponsor_party`, `billsponsor_sex`).


**Monadic covariates for Senators**

* `seniority`: seniority of the senators
* `ideol1`: ideology dim 1
* `ideol2`: ideology dim 2
* `party` : party label
* `sex` : sex of senator

**Monadic covariates for Bills** 

* `Major2`: crude categories of type of bill, where
  - 1 = Economy (1=Macro, 4=Agriculture, 5=Labor,8=Energy,15=Domestic Commerce,17=Tech,18=Foreign Trade,19=International), 
  - 2 = Legal (2=Civil Rights,9=Immigration,12=Law&Crime)
  - 3 = Social programs/Public goods (3=Health,6=Education,7=Environment, 10=Transportation,13=Social Welfare,14=Housing, 21=Public lands,23=Culture)
  - 4 = Security (16=Defense)
  - 5 = Gov operations (20=Gov operations)
  - 6 = Other (all others)
* `billsponsor_seniority`: seniority of the senator who sponsored the bill
* `billsponsor_ideol1`: ideology dim 1 of the senator who sponsored the bill
* `billsponsor_ideol2`: ideology dim 2 of the senator who sponsored the bill
* `billsponsor_party` : party label of the senator who sponsored the bill
* `billsponsor_sex` : sex of senator who sponsored the bill
* (We don't use the variable `private` because only 5 ones, otherwise all zeros)

Dyadic covariates: 

* `reciprocity_prop`: for a given senator-bill dyad, whether the senator (i) sponsored bills in the previous session that the sponsor of this current bill cosponsored, over total sponsored bills by senator (i) in previous session.

Find `k1` and `k2` values such that the AUC is maximized for a small subsample. Here we use 10% for training and 10% for testing.

```{r,eval=FALSE,echo=FALSE,warning=FALSE,message=FALSE}
dyad.data$tid<-dyad.data$time
senate$tid<-senate$time
bills$tid<-bills$time

#set.seed(123): 3, 4
#set.seed(1234): 4, 3 (though very close to 3, 3)
set.seed(12345) #3,4
sample_split_index<-sample(1:node2,node2,replace=FALSE) #sample split based on Family 2
train.data.dyad<- dyad.data[which(dyad.data$node2%in%sample_split_index[1:round(node2*0.1)]),]
test.data.dyad<- dyad.data[which(dyad.data$node2%in%sample_split_index[(round(node2*0.1)+1):round(node2*0.2)]),]
train.data.monad1 <- senate
train.data.monad2 <- bills[which(bills$node2%in%sample_split_index[1:round(node2*0.1)]),]
test.data.monad2 <- bills[which(bills$node2%in%sample_split_index[(round(node2*0.1)+1):round(node2*0.2)]),]

mychoiceK<-chooseK(formula.dyad = Y ~ reciprocity_prop0 + lreciprocity_prop,
                    formula.monad1 = ~ seniority + ideol1 + ideol2 + as.factor(party) + sex, #
                    formula.monad2 = ~ as.factor(Major2) + billsponsor_seniority + billsponsor_ideol1 + billsponsor_ideol2 +
                     billsponsor_party + billsponsor_sex,
                    senderID = "node1",
                    receiverID = "node2",
                    nodeID1 = "node1",
                    nodeID2 = "node2",
                    timeID = "tid",
                  train.data.dyad = train.data.dyad, 
                  test.data.dyad = test.data.dyad,
                  train.data.monad1 = train.data.monad1, 
                  test.data.monad1 = NULL,
                  train.data.monad2 = train.data.monad2, 
                  test.data.monad2 = test.data.monad2,
                  k1=c(2,3,4), 
                  k2=c(2,3,4),
                  n.hmmstates= 1,
                  mmsbm.control = list(spectral = TRUE,
                                         hessian = TRUE,
                                         verbose=TRUE,
                                         vi_iter = 500,
                                         conv_tol = 1e-6,
                                         bipartite = TRUE
                                   #,batch_size1 = .80, batch_size2 = .80
                                   )
                  )
#nodes2 = nrow(train.data.monad2),
                  #npred2 = 1+5+5,#+1 for intercept
#mychoiceK$bestk: 3, 4
saveRDS(mychoiceK,file="cosponsor_data/mychoiceK-107.rds")
```

```{r,eval=TRUE,echo=FALSE,warning=FALSE,message=FALSE}
mychoiceK<-readRDS(file="cosponsor_data/mychoiceK-107.rds")
```

k1=3/k2=3 and k1=3/k2=4 are the combinations with the highest out of sample AUCs consistently (the latter slightly higher), but we lean to 3/3 based on eyeballing mixed membership probabilities in the bills groups (sorting suggests 3 groups with a little noise).

**K1=3,K2=4**
```{r,eval=FALSE,echo=FALSE,warning=FALSE,message=FALSE}
formula.monad1 = ~ seniority + ideol1 + ideol2 + as.factor(party) + sex
formula.monad2 = ~ as.factor(Major2) + billsponsor_seniority + billsponsor_ideol1 + 
                billsponsor_ideol2 + billsponsor_party + billsponsor_sex
data.monad1 = senate
data.monad2 = bills
n.blocks1 = 3#blocks for legislators
n.blocks2 = 2#blocks for bills
nodeID1 = "node1"
nodeID2 = "node2"
#t<-Sys.time()
co.model2 <- mmsbm(formula.dyad = Y ~ reciprocity_prop0 + lreciprocity_prop,
                    formula.monad = list(formula.monad1,formula.monad2),
                    bipartite=TRUE,
                    senderID = "node1",
                    receiverID = "node2",
                    nodeID = list(nodeID1, nodeID2),
                    timeID = "time",
                    data.dyad = dyad.data,
                    data.monad = list(senate,bills),
                    n.blocks = list(n.blocks1,n.blocks2),
                    n.hmmstates = 1,
                    directed = TRUE,
                    mmsbm.control = list(seed=12345, spectral = TRUE,
                                         hessian = TRUE,
                                         verbose=TRUE,
                                         vi_iter = 1,
                                         conv_tol = 1e-6,
                                         bipartite = TRUE
                                   #,batch_size1 = .80, batch_size2 = .80
                                   ))
#t<-Sys.time()-t
#save(co.model2,file="congress107results/comodel-k34_B.RData") #verB with 0.5 as variance for monadic/beta intercepts, no _B is 1.0 variance
saveRDS(co.model2,file="congress107results/comodel-k34_B.rds")
#saveRDS(co.model2,file="congress107results/comodel-k23_B.rds")
#saveRDS(co.model2,file="congress107results/comodel-k33_B.rds")
```

Time difference of 11.3141 minutes.

## Visualization of returned model output

We can look at summaries of the returned information.

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
dyad.data107<-readRDS("cosponsor_data/dyad-data-107.rds")
senate107<-readRDS("cosponsor_data/senate-107.rds")
bills107<-readRDS("cosponsor_data/bills-107.rds")
node1=nrow(senate107)
node2=nrow(bills107)
model107<-readRDS("congress107results/comodel-k34_B.rds")
#rearrange group ordering so that mixed membership groups 1 and 3 swap; this way they match based on proportion Democrat/Republican, for Session 108 -- 1- Republican, 2- Mix/Indep, 3- Democrat
#model107$`MixedMembership 1`<-model107$`MixedMembership 1`[c(3,2,1),]
#do the same for Blockmodel
#model107$BlockModel<-model107$BlockModel[c(3,2,1),]
#do the same for MonadCoef1
#model107$MonadCoef1<-model107$MonadCoef1[,c(3,2,1),]
#colnames(model107$MonadCoef1)<-c("Group 1","Group 2","Group 3")

```


### Group Memberships

For instance, what is the probability of edges being drawn between the two sets of latent groups? Note we denote the latent groups of first class of nodes (**senators**) by **G**, and the latent groups of second class of nodes (**bills**) by **H**.

**Blockmodel**
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
block<-(model107$BlockModel)
rownames(block)<-c("Senate Group 1","Senate Group 2", "Senate Group 3")#, "Senate Group 4")
colnames(block)<-c("Bills Group 1","Bills Group 2","Bills Group 3", "Bills Group 4")
kable(block,digits=3)

plot.mmsbmB(model107,type="block")
```

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
plot.mmsbmB(model107,type="groups")
#Figures/107_k23_plot.pdf
```

Senators (G) in all three latent groups are more likely to form edges with Bills (H) in latent group 1, and all are less likely to form edges with Bills (H) in group 2 and 3. Bills in group H3 are most likely to form edges with Senators in G1 and G3, and slightly less with Senators in G2. 

#### Senator latent groups

How are senators clustering in the latent group space? 
<!-- We will visualize via ternary plots as we have estimated a model with 3 latent groups on the senator side. -->

**Senator Latent Group Plots**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
#TERNARY
###  Congressional latent groups
 dat<-data.frame(name=senate107$labels,party=senate107$party,group1=model107$`MixedMembership 1`[1,]
                    ,group2=model107$`MixedMembership 1`[2,]
                 ,group3=model107$`MixedMembership 1`[3,])
 dat$color<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
 #sort by group probas
 dat<-dat[order(-dat$group1,-dat$group2,-dat$group3),]
 dat$name<-as.vector(dat$name)
#sample from rows of senators because way too many
 #dat<-dat[seq(1,nrow(dat),2),]
 dat$name<-factor(dat$name, levels = dat$name)
 TernaryPlot(atip="Group 1", btip="Group 2", ctip="Group 3", point="up")
 AddToTernary(points, dat[,c("group1","group2","group3")]*100, pch=21, cex=1.5,
              bg=apply(dat[,c("group1","group2","group3")]*100, 1,
                       function (x) rgb(x[3], x[2], x[1], 128, maxColorValue=255)))

dat2<-apply(dat[,c("group1","group2","group3")]*100,1,jitter,amount=5)
AddToTernary(text, t(dat2), dat$name, cex=0.5, font=2, col=dat$color)


##2 K
###  Congressional latent groups
# dat<-data.frame(name=senate107$labels,party=senate107$party,group1=model107$`MixedMembership 1`[1,]
#                    ,group2=model107$`MixedMembership 1`[2,])
# dat$pcolor<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
# 
# #sort by group probas
# dat<-dat[order(-dat$group1,-dat$group2),]
# dat$name<-as.vector(dat$name)
# tmp_color<-dat$pcolor
# dat %>%
#   arrange(group1) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
#   mutate(name=factor(name, levels=name)) %>%   # This trick update the factor levels
#   ggplot( aes(x=name, y=group1)) +
#     geom_segment(aes(xend=name, yend=0),color="gray",alpha=0.5) +
#     geom_point(size=3,aes(colour = factor(name))) +
#     coord_flip() +
#     theme_bw() + theme(legend.position="none") + 
#     xlab("") + ylab("Probability in Group 1") + scale_colour_manual(values = rev(tmp_color))
```

Senators latent groups 1- 3 are mostly composed of Democrat senators (group 1 more likely from the South, than group 3), while Group 2 leans more heavily Republican. Latent group memberships are well sorted into the three corners of the ternary plot.
 
What are the senators with highest membership in each latent group?

**Top 10 members of senator latent groups, by probas**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"}
plot_data<-topmmB(model107$`MixedMembership 1`,n=10,names=senate107$labels)
vars<-c("names","probability")
rownames(plot_data)<-NULL
temp<-as.data.frame(cbind(subset(plot_data,group==1)[,vars],subset(plot_data,group==2)[,vars]
            ,subset(plot_data,group==3)[,vars]))#,subset(plot_data,group==4)[,vars]))
colnames(temp)=c("Names","Group 1","Names","Group 2","Names","Group 3")#,"Names","Group 4")
kable(temp)
```

#### Bills latent groups

How are bills clustering in the latent group space? 4 Latent groups]{color="red"}

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 8, fig.width = 11, fig.align = "center"}
dat<-data.frame(name=bills107$billnum,type=bills107$billtype,category=bills107$Major2
                ,seniority=bills107$billsponsor_seniority,ideol1=bills107$billsponsor_ideol1,ideol2=bills107$billsponsor_ideol2
                ,party=bills107$billsponsor_party,sex=bills107$billsponsor_sex
                ,group1=model107$`MixedMembership 2`[1,]
                   ,group2=model107$`MixedMembership 2`[2,],group3=model107$`MixedMembership 2`[3,])
dat$color<-ifelse(dat$category==1,"darkslateblue"           #Economy
                  ,ifelse(dat$category==2,"darkgoldenrod1"  #Intl
                  ,ifelse(dat$category==3,"forestgreen"     #Social programs/Public goods
                  ,ifelse(dat$category==4,"firebrick1"      #Security
                  ,ifelse(dat$category==5,"purple"          #gov programs
                          , "gray")                                 #Other
                          ))))
dat$color_party<-ifelse(dat$party=="Democrat","dodgerblue","firebrick")
#sort by group probas
dat<-dat[order(-dat$group1,-dat$group2,-dat$group3),]
#sample from rows of bills because way too many
dat<-dat[seq(1,nrow(dat),2),]
TernaryPlot(atip="Group 1", btip="Group 2", ctip="Group 3", point="up")
AddToTernary(points, dat[,c("group1","group2","group3")]*100, pch=21, cex=1.5,
             bg=apply(dat[,c("group1","group2","group3")]*100, 1,
                      function (x) rgb(x[1], x[2], x[3], 128, maxColorValue=255)))

dat2<-apply(dat[,c("group1","group2","group3")]*100,1,jitter,amount=15)
AddToTernary(text, t(dat2), as.character(dat$name), font=2, col=dat$color_party
             #, cex=(dat$ideol1+0.8)
             )
```

<!-- Above is pretty resilient group membership distribution with slightly different bill category rules. -->

What are the top bills?

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
plot_data<-topmmB(model107$`MixedMembership 2`,n=20,names=bills107$billnum)
vars<-c("names","probability")
rownames(plot_data)<-NULL
temp<-as.data.frame(cbind(subset(plot_data,group==1)[,vars],subset(plot_data,group==2)[,vars]
            ,subset(plot_data,group==3)[,vars],subset(plot_data,group==4)[,vars]))
colnames(temp)=c("Names","Group 1","Names","Group 2","Names","Group 3","Names","Group 4")
kable(temp)
```


**Group 1**
[Latent group characterized by small number of bills with high probability in group -- but high likelihood of edge formation with all senate latent groups. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be resolutions (concurrent/joint as well).The types of bills most likely to be in this group are ones that are about expressing views on domestic, international norms. They are also likely to have (~3 - ~ 50 large range) numbers of cosponsors .]{color="orange"}

* SC_107_27: A concurrent resolution expressing the sense of Congress that the 2008 Olympic Games should not be held in Beijing unless the Government of the People's Republic of China releases all political prisoners, ratifies the International Covenant on Civil and Political Rights, and observes internationally recognized human rights. (3)
* SC_107_60: A concurrent resolution expressing the sense of the Congress that the continued participation of the Russian Federation in meetings of the Group of Eight countries must be conditioned on the Russian Federation's voluntary acceptance of and adherence to the norms and standards of democracy. (3)
* SC_107_62: A concurrent resolution congratulating Ukraine on the 10th anniversary of the restoration of its independence and supporting its full integration into the Euro-Atlantic community of democracies.
* SC_107_91: A concurrent resolution expressing deep gratitude to the government and the people of the Philippines for their sympathy and support since September 11, 2001, and for other purposes.
* SE_107_107: A resolution congratulating the people of Peru on the occasion of their democratic elections on June 3, 2001. (5)
* SE_107_27: A resolution to express the sense of the Senate regarding the 1944 deportation of the Chechen people to central Asia, and for other purposes.
* SE_107_67: A resolution commending the Blue Devils of Duke University for winning the 2001 National Collegiate Athletic Association Men's Basketball Championship.
* SE_107_81: A resolution commending the members of the United States mission in the People's Republic of China for their persistence, devotion to duty, sacrifice, and success in obtaining the safe repatriation to the United States of the crew of the Navy EP-3E ARIES II aircraft who had been detained in China. (3)
* SJ_107_27: A joint resolution relating to the political, economic, and military relations of the United States with Nicaragua. (2)
* SE_107_16: A resolution designating August 16, 2001, as "National Airborne Day". (59)
* SE_107_159: A resolution designating the week beginning September 16, 2001, as "National Historically Black Colleges and Universities Week". (50)
* SE_107_242: A resolution designating August 16, 2002, as "National Airborne Day". (41)
* SE_107_305: A resolution designating the week beginning September 15, 2002, as "National Historically Black Colleges and Universities Week". (33)
* SC_107_79: S.Con.Res.79 — 107th Congress (2001-2002) A concurrent resolution expressing the sense of Congress that public schools may display the words "God Bless America" as an expression of support for the Nation. (6)
* SJ_107_1: A joint resolution proposing an amendment to the Constitution of the United States relating to voluntary school prayer.
* SE_107_278: A resolution calling upon all Americans to recognize on this Memorial Day, 2002, the sacrifice and dedication of our Armed Forces and civilian national security agencies.
* SE_107_212: A resolution expressing the condolences of the Senate to the family of Daniel Pearl. (7)
* SE_107_127: A resolution commending Gary Sisco for his service as Secretary of the Senate. (3)
* SE_107_111: A resolution commending Robert "Bob" Dove on his service to the Senate.
* SE_107_54: A resolution authorizing expenditures by the committees of the Senate for the periods March 1, 2001, through September 30, 2001, October 1, 2001, through September 30, 2002, and October 1, 2002, through February 28, 2003.

**Group 2**
[Latent group characterized by moderate number of bills with high probability in group -- and moderate likelihood of edge formation with all senate latent groups, though most probas with Senate Group 3 . Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be bills. The types of bills most likely to be in this group are ones that are about programs and policies around defense/military, healthcare, education. They are also likely to have (~5 low) numbers of cosponsors .]{color="orange"}

* SN_107_1264: A bill to require the conveyance of a petroleum terminal serving former Loring Air Force Base and Bangor Air National Guard Base, Maine. (1)
* SN_107_296: A bill to authorize the conveyance of a segment of the Loring Petroleum Pipeline, Maine, and related easements. 
Directs the Secretary of the Air Force to convey to the Loring Development Authority the segment of the Loring Petroleum (POL) Pipeline that runs between the Searsport terminal and Bangor Air National Guard Base and that was not previously conveyed following the closure of Loring Air Force Base. (1)
* SN_107_1037: A bill to amend title 10, United States Code, to authorize disability retirement to be granted posthumously for members of the Armed Forces who die in the line of duty while on active duty, and for other purposes. (15)
* SN_107_2509: Transparent and Enhanced Criteria Act of 2002. Amends the Defense Base Closure and Realignment Act of 1990 to add the following to the selection criteria for the 2005 round of defense base closures and realignments: (1) force structure and mission requirements through 2020; (2) the availability and condition of facilities, land, and associated airspace; (3) considerations regarding ranges and airspace; (4) force protection; (5) costs and effects of relocating critical infrastructure; (6) homeland security requirements; (7) State or local support for a continued presence by the Department of Defense; (8) applicable lessons from previous rounds of closures and realignments; and (9) anticipated savings and other benefits. (16)
* SN_107_409: Persian Gulf War Illness Compensation Act of 2001. Amends a veterans' benefits program of compensation for disabilities occurring in veterans of the Persian Gulf War. (16) 
* SN_107_1023: A bill to modify the land conveyance authority with respect to the Naval Computer and Telecommunications Station, Cutler, Maine. (1)
* SN_107_1108: A bill to authorize the transfer and conveyance of real property at the Naval Security Group Activity, Winter Harbor, Maine, and for other purposes. (1)
* SN_107_1289: A bill to require the Secretary of the Navy to report changes in budget and staffing that take place as a result of the regionalization program of the Navy. (1)
* SN_107_457: A bill to amend title 38, United States Code, to establish a presumption of service-connection for certain veterans with Hepatitis C, and for other purposes. Considers hepatitis C becoming manifest in a veteran to a degree of ten percent or more to be service-connected, and therefore compensable under veterans' disability provisions, notwithstanding that there is no record of evidence of such illness during the period of such service, as long as it is shown that during such service the veteran experienced: (1) a blood transfusion before December 31, 1992; (2) blood exposure on or through skin or a mucous membrane; (3) hemodialysis; (4) a needle-stick accident or medical event involving a needle, not due to willful misconduct; (5) unexplained liver disease; (6) an unexplained liver dysfunction value or test; or (7) working in a health-care position or specialty. (11) 
* SN_107_666: A bill to amend the Internal Revenue Code of 1986 to allow the use of completed contract method of accounting in the case of certain long-term naval vessel construction contracts. (10)
* SN_107_1096: Military Spouse Physician Choice Act (1)
* SN_107_1159: Lubec Safe Harbor Act of 2001 (1)
* SN_107_1367: Medicare Rural Ambulance Relief Act of 2001 (2)
* SN_107_1570: Higher Education Relief Opportunities for Students Act of 2001. Authorizes the Secretary of Education to waive or modify certain requirements of student financial aid programs under title IV of the Higher Education Act of 1965 as the Secretary deems necessary in connection with the national emergency declared by the President with respect to the terrorist attacks of September 11, 2001, or any subsequent national emergency declared by reason of terrorist attacks (the emergency). (13)
* SN_107_1633: Suburban and Community Forestry and Open Space Initiative Act of 2001 (1)
* SN_107_1793: Higher Education Relief Opportunities for Students Act of 2001. Authorizes the Secretary of Education to waive or modify certain requirements of student financial aid programs under title IV of the Higher Education Act of 1965 as necessary in connection with the national emergency declared by the President with respect to the terrorist attacks of September 11, 2001, or any subsequent national emergency declared by reason of terrorist attacks (the emergency). (17)
* SN_107_1833: A bill to amend the Public Health Service Act with respect to qualified organ procurement organizations. Amends the Public Health Service Act to state that a qualified organ procurement organization's certification or recertification in effect as of January 1, 2000, remains in effect at least through July 31, 2004, and is subject to subsequent recertification not more frequently than every four years. (2)
* SN_107_1918: Mathematics, Science, and Special Education Teacher Recruitment Act of 2002. Amends the Higher Education Act of 1965 to establish new programs of student guaranteed and direct loan forgiveness for highly qualified mathematics, science, and special education teachers in high-need schools. (10)
* SN_107_1948: Medicare Value and Quality Demonstration Act of 2002. (3)
* SN_107_203: Teacher Support Act of 2001. Amends the Internal Revenue Code to: (1) make the two percent floor on miscellaneous itemized deductions inapplicable to qualified professional development expenses incurred by elementary and secondary school teachers and aides; and (2) allow a credit to elementary and secondary school teachers, instructors, counselors, aides, or principals who provide classroom materials. (3)


**Group 3**
[Latent group characterized by a large number of bills with, in decreasing order, likelihood of forming edges with Senate Latent groups 3, 1 ,2. Bills that have the highest probability of being in this group are sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about federal benefits (bureaucratic/admin), and federal recognition of individuals. They are also likely to have (~10) numbers of cosponsors .]{color="orange"}

* SN_107_2900: A bill to designate the facility of the United States Postal Service located at 6101 West Old Shakopee Road in Bloomington, Minnesota, as the "Thomas E. Burnett, Jr. Post Office Building". 
* SN_107_663: A bill to authorize the President to present a gold medal on behalf of Congress to Eugene McCarthy in recognition of his service to the Nation.(1)
* SN_107_719: Clean Money, Clean Elections Act. Amends the Federal Election Campaign Act of 1971 (FECA) to: (1) prescribe eligibility and qualifying contribution requirements, seed money provisions, and benefits of clean money financing of Senate election campaigns; (2) set forth requirements applicable to clean money candidates; (3) direct the Federal Election Commission (FEC) to certify if a candidate is such a candidate and to assess a certain civil penalty against any such candidate making an expenditure from funds other than clean money funds; (4) establish in the Treasury a Senate Election Fund for clean money financing; (5) set forth requirements concerning reporting of certain expenditures of private money candidates and of independent expenditures, as redefined; (6) limit expenditures that may be made by political party committees in connection with the general election campaign of a Senate election in which one or more of the candidates is a clean money candidate; and (7) require a committee of a political party, before making coordinated expenditures in excess of $5,000 for a Federal election, to certify to the FEC that it has not and will not make any independent expenditures in connection with such campaign. Amends the Communications Act of 1934 to entitle clean money candidates to receive specified free broadcast time. (4)
* SN_107_2874: Domestic Partnership Benefits and Obligations Act of 2002. Entitles domestic partners of Federal employees to benefits available to spouses of Federal employees. Specifies certifications required for benefit eligibility, filing requirements regarding partnership dissolution, and confidentiality requirements. Amends the Internal Revenue Code to extend the tax exemption for employer contributions to accident and health plans to domestic partners under this Act. (6)
* SN_107_177: Postmasters Fairness and Rights Act. Amends Federal law to prescribe guidelines within which the Postal Service shall propose changes in pay policies, schedules, and fringe benefit programs affecting postmasters which are to be in effect during the period covered by a collective bargaining agreement between the Postal Service and certain recognized bargaining representatives. Grants certain qualified postmasters' organizations the right to participate in program planning and development pertaining to pay policies, schedules, and fringe benefits. (49)
* SN_107_1821: A bill to amend title 5, United States Code, to allow certain catch-up contributions to the Thrift Savings Plan to be made by participants age 50 or over, and to afford employees and Members full immediate participation in the Thrift Savings Plan upon commencing Federal service. (1)
* SN_107_1822: A bill to amend title 5, United States Code, to allow certain catchup contributions to the Thrift Savings Plan to be made by participants age 50 or over. (2)
* SN_107_3070: A bill to authorize appropriations for the Merit Systems Protection Board and the Office of Special Counsel, and for other purposes. (2)
* SN_107_995: A bill to amend chapter 23 of title 5, United States Code, to clarify the disclosures of information protected from prohibited personnel practices, require a statement in non-disclosure policies, forms, and agreements that such policies, forms and agreements conform with certain disclosure protections, provide certain authority for the Special Counsel, and for other purposes. (5)
* SN_107_2227: A bill to clarify the effective date of the modification of treatment for retirement annuity purposes of part-time services before April 7, 1986, of certain Department of Veterans Affairs health-care professionals. (1)
* SN_107_1184: A bill to designate the facility of the United States Postal Service located at 2853 Candler Road in Decatur, Georgia, as the "Earl T. Shinhoster Post Office". (1)
* SN_107_126: A bill to authorize the President to present a gold medal on behalf of Congress to former President Jimmy Carter and his wife Rosalynn Carter in recognition of their service to the Nation. (17)
* SN_107_1476: A bill to authorize the President to award a gold medal on behalf of the Congress to Reverend Doctor Martin Luther King, Jr. (posthumously) and his widow Coretta Scott King in recognition of their contributions to the Nation on behalf of the civil rights movement. (11)
* SN_107_1906: A bill to designate the facility of the United States Postal Service located at 3698 Inner Perimeter Road in Valdosta, Georgia, as the "Major Lyn McIntosh Post Office Building". (1)
* SN_107_3077: A bill to designate the facility of the United States Postal Service located at 206 South Main Street in Glennville, Georgia, as the "Michael Lee Woodcock Post Office". (2)
* SN_107_871: Federal Air Traffic Controllers Annuity Computation Act of 2001. Allows Federal air traffic controllers retiring under the Civil Service Retirement System (CSRS) to have their annuities computed under provisions similar to annuity computation provisions applicable to law enforcement officers, firefighters, and nuclear materials couriers retiring under CSRS. (16) 
* SN_107_2594: Support of American Eagle Silver Bullion Program Act. Requires the Secretary of the Treasury to obtain silver from other available sources when the United States silver stockpile is depleted. Prohibits the Secretary from paying more than the average world price for silver under any circumstances. (5)
* SN_107_737: A bill to designate the facility of the United States Postal Service located at 811 South Main Street in Yerington, Nevada, as the "Joseph E. Dini, Jr. Post Office". (1)
* SN_107_2219: Steve Grissom Relief Fund Act of 2002. Establishes the Steve Grissom Relief Fund in the Treasury. Directs the Secretary of Health and Human Services to make single payments to individuals infected with HIV or diagnosed with AIDS as a result of HIV- contaminated blood, blood components, human tissue or organs. Includes lawful spouses, as specified.(5)
* SN_107_1422: A bill to provide for the expedited payment of certain benefits for a public safety officer who was killed or suffered a catastrophic injury as a direct and proximate result of a personal injury sustained in the line of duty in connection with the terrorist attacks of September 11, 2001. (13)

**Group 4**
[Latent group characterized by a small number of bills with, in decreasing order, likelihood of forming edges with Senate Latent groups 3 and then 1/2. Bills that have the highest probability of being in this group are more likely to be sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about interactions and sharing of info between federal and state bodies/jurisdiction, minority services (elderly, women, immigrants, fostercare, LGBTQ+, prisoners). They are also likely to have (~1 - ~60 wide range of) numbers of cosponsors .]{color="orange"}

* SN_107_1749: Enhanced Border Security and Visa Entry Reform Act of 2001. Directs the Attorney General to waive Immigration and Naturalization Service (INS) personnel limits. Authorizes appropriations for INS, Border Patrol, United States Customs Service, and consular personnel, training, facilities, and security-related technology. Provides for machine-readable visa fees. Directs U.S. law enforcement and intelligence entities to share alien admissibility- and deportation-related information with INS and the Department of State. (66)
* SN_107_625: Local Law Enforcement Enhancement Act of 2001. Authorizes the Attorney General to provide technical, forensic, prosecutorial, or other assistance in the criminal investigation or prosecution of any crime that: (1) constitutes a crime of violence under Federal law or a felony under State or Indian tribal law; and (2) is motivated by prejudice based on the race, color, religion, national origin, gender, sexual orientation, or disability of the victim or is a violation of the hate crime laws of the State or tribe. Directs the Attorney General to give priority for assistance to crimes committed by offenders who have committed crimes in more than one State and to rural jurisdictions that have difficulty covering the extraordinary investigation or prosecution expenses. (5)
* SN_107_1284: Employment Non-Discrimination Act of 2002. Prohibits employment agencies, labor organizations, and training programs from engaging in specified unlawful employment practices (discrimination) based upon sexual orientation. (44)
* SN_107_2444: Immigration, Reform, Accountability, and Security Enhancement Act of 2002. (12)
* SN_107_1618: Enhanced Border Security Act of 2001.  Directs the Secretary of State (Secretary), the Commissioner of the Immigration and Naturalization Service (Commissioner), and the Director of Central Intelligence to submit a congressional report, and develop a plan and an interoperable intelligence data system (with the Attorney General), for the identification and provision of law enforcement and intelligence information needed by the Department of State and the Immigration and Naturalization Service (INS) to screen visa and admissions applicants. (11)
* SN_107_1452: A bill to provide for electronic access by the Department of State and Immigration and Naturalization Service to certain information in the criminal history records of the Federal Bureau of Investigation to determine whether or not a visa applicant or applicant for admission has a criminal record. (5)
* SN_107_1424: A bill to amend the Immigration and Nationality Act to provide permanent authority for the admission of "S" visa non-immigrants. (4)
* SN_107_955: Immigrant Fairness Restoration Act of 2001. Amends the Immigration and Nationality Act to revise specified restrictions respecting: (1) cancellation of removal; (2) deportability and admissibility; (3) judicial review; (4) right to counsel; (5) detention; (6) applicants for admission; (7) removal of aliens who are not permanent residents and who have no relief from removal; (8) reopening of certain proceedings and parole of certain aliens; and (9) aliens who have made false citizenship claims or who have unlawfully voted. (10)
* SN_107_2707: Women's Pension Protection Act of 2002. (3)
* SN_107_2619: Prison Rape Reduction Act of 2002. Directs the Bureau of Justice Statistics to carry out an annual, comprehensive statistical review and analysis of the incidence and effects of prison rape. Establishes within the Bureau the Review Panel on Prison Rape. Directs the Panel to request the public testimony of Federal, State, and local officials who bear responsibility for the prevention, detection, and punishment of prison rape at specified entities. Provides for a reduction in Federal funds for entities whose officials refuse to testify. (1)
* SN_107_1313: H-2A Reform and Agricultural Worker Adjustment Act of 2001. Directs the Attorney General, upon completion of specified agricultural work and residency requirements, to adjust the status of a qualifying alien agricultural worker (and spouse and minor children) to that of a: (1) lawfully admitted temporary nonimmigrant; and (2) permanent resident nonimmigrant. (3)
* SN_107_2435: Preservation of Civil Rights Protections Act of 2002. Amends the Federal Arbitration Act to exclude all employment contracts from arbitration provisions (current law excludes employment contracts of seamen, railroad employees, or any other class of workers engaged in foreign or interstate commerce). (3)
* SN_107_938: A bill to amend the Internal Revenue Code of 1986 to provide that the exclusion from gross income for foster care payments shall also apply to payments by qualifying placement agencies, and for other purposes. (4)
* SN_107_928: Older Workers' Rights Restoration Act of 2001. Amends the Age Discrimination in Employment Act of 1967 to require States to waive their sovereign immunity to lawsuit for violations of such Act against State employees in programs or activities that receive Federal financial assistance. (2)
* SN_107_1888: A bill to amend title 18 of the United States Code to correct a technical error in the codification of title 36 of the United States Code. Amends the Federal criminal code with respect to trafficking in counterfeit goods or services to make a technical correction in the codification of title 36 (Patriotic and National Observances, Ceremonies, and Organizations) regarding the definition of a counterfeit mark. (4)
* SN_107_2459: A bill to provide for a terrorist identification classification system, and for other purposes. Requires the Director of Central Intelligence (DCI) to: (1) establish and maintain a list of individuals and organizations that are known or suspected to be international terrorists or terrorist organizations; and (2) ensure that pertinent information on such list is shared with such Federal, State, and local departments and such agencies and entities of foreign governments and international organizations as the DCI considers appropriate. Designates such list as the Terrorist Identification Classification System. Requires the DCI to: (1) review and update the System; (2) report to the congressional intelligence committees on the criteria used to determine which System information is shared; and (3) ensure the interoperability of the System with relevant information systems of appropriate departments, agencies, and foreign and international governments and organizations. (1)
* SN_107_1435: Federal Investigation Enhancement Act of 2001. Amends the Federal judicial code to modify provisions regarding ethical standards to authorize a Government attorney, for the purpose of enforcing Federal law, to provide legal advice, authorization, concurrence, direction or supervision on conducting covert activities, and to participate in such activities, even though such activities may require the use of deceit or misrepresentation. (1)
* SN_107_2826: Our Lady of Peace Act. Amends the Brady Handgun Violence Prevention Act to require the head of each U.S. department or agency to ascertain whether it has such information on persons for whom receipt of a firearm would violate specified Federal provisions regarding excluded individuals or State law as is necessary to enable the National Instant Criminal Background Check System to operate. Directs that any such record that the department or agency has be made available to the Attorney General for inclusion in the National Instant Criminal Background Check System or transmission of a certification identifying the record for removal from the System. Directs the head of such department or agency, at the Attorney General's request, to furnish such information to the System electronically. (11)
* SN_107_1074: FBI Reform Commission Act of 2001. Establishes the FBI Review Commission to: (1) examine the systemic and structural aspects of the Federal Bureau of Investigation (FBI), as well as the FBI's relationship with other law enforcement entities; (2) make recommendations for improving the FBI's performance and (3) undertake related reviews and studies. (3)
* SN_107_1615: Federal-Local Information Sharing Partnership Act of 2002. (6)


### Dyadic predictors

We use a sponsor-cosponsor reciprocity variable `lreciprocity_prop` as a dyadic predictor. The variable takes the number of times the senator (node 1) has sponsored a bill that was cosponsored by (node 2) in the previous session 106 over a denominator of the total number of times the senator (node 1) sponsored bills in the previous session. 

Below is the adjacency matrix for reciprocity  between row Senators of Congress 107 and column Senators of Congress 106 (only showing senators who appear in 106 and also appear in 107 for columns). 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE, fig.height = 8, fig.width = 8, fig.align = "center"}
sponsor_history107<-readRDS(file="cosponsor_data/sponsor_history107.rds") #save cosponsorship history info
sub_sponsor_history107<-sponsor_history107[,which(rownames(sponsor_history107)%in%colnames(sponsor_history107))]

plot.sociomatrix(sub_sponsor_history107,drawlab=FALSE,cex.lab=0.5,col.lab="dodgerblue4")

summary107<-summary.mmsbmB(model107)
summary107$`Dyadic Coefficients`
```

[The estimated coefficient on `lreciprocity_prop` is `r round(model107$DyadCoef[2],3)`. When facing a bill today, a senator who has had a sponsorship history with the senator-sponsor is more likely to cosponsor today's bill.  (conditional on having any non-zero sponsorship history). The coefficient estimated on the binary variable for `reciprocity_prop0` (if not zero then 1, if zero then 0) is `r round(model107$DyadCoef[1],3)`.]{color="orange"}

### Senator predictors

We might be interested in seeing how monadic predictors at the senator level are distributed for each of the groups:

**Senator Monadic Predictors**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
coef1<-as.matrix(model107$MonadCoef1[,,1])
colnames(coef1)<-c("Senate Group 1","Senate Group 2", "Senate Group 3")#, "Senate Group 4")
rownames(coef1)<-c("Intercept","Seniority","Ideol1","Ideol2","Republican","Male")
kable(coef1,digits=3)
```

Senators in groups 1 and 3 are more likely to score negatively on `ideol1`, be Democrats, and be slightly less senior, with group 3 as more extreme than group 1. Senators with higher membership probabilities in group 2 are more likely to score positively on `ideol1` and be Republican and male. 

**Senator: Ideology, Dimension 1**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="ideol1",family=1)
```

**Senator: Ideology, Dimension 2**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="ideol2",family=1)
```

**Senator: Seniority**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="seniority",family=1)
```

**Senator: Party**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="as.factor(party)",family=1)
```

**Senator: Sex**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="sex",family=1)
```

### Bills predictors

**Bills Monadic Predictors**
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
coef1<-as.matrix(model107$MonadCoef2[,,1])
colnames(coef1)<-c("Bills Group 1","Bills Group 2","Bills Group 3","Bills Group 4")
rownames(coef1)<-c("Intercept","Major2:2","Major2:3","Major2:4","Major2:5","Major2:6"
                   ,"Sponsor Seniority","Sponsor Ideol1","Sponsor Ideol2","Sponsor Republican","Male")
kable(coef1,digits=3)
```

[Group 1: Latent group characterized by small number of bills with high probability in group -- but high likelihood of edge formation with all senate latent groups. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be resolutions (concurrent/joint as well).The types of bills most likely to be in this group are ones that are about expressing views on domestic, international norms (Other category in `Major2` variable). They are also likely to have (~3 - ~ 50 large range) numbers of cosponsors .]{color="orange"}

[Group 2: Latent group characterized by moderate number of bills with high probability in group -- and moderate likelihood of edge formation with all senate latent groups, though most probas with Senate Group 3 . Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be bills. The types of bills most likely to be in this group are ones that are about programs and policies around defense/military, healthcare, education. They are also likely to have (~5 low) numbers of cosponsors .]{color="orange"}

[Group 3: Latent group characterized by a large number of bills with, in decreasing order, likelihood of forming edges with Senate Latent groups 3, 1 ,2. Bills that have the highest probability of being in this group are sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about federal benefits (bureaucratic/admin), and federal recognition of individuals (Cateogry 5 in `Major2`). They are also likely to have (~10) numbers of cosponsors .]{color="orange"}


[Group 4: Latent group characterized by a small number of bills with, in decreasing order, likelihood of forming edges with Senate Latent groups 3 and then 1/2. Bills that have the highest probability of being in this group are more likely to be sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about interactions and sharing of info between federal and state bodies/jurisdiction, minority services (elderly, women, immigrants, fostercare, LGBTQ+, prisoners). They are also likely to have (~1 - ~60 wide range of) numbers of cosponsors .]{color="orange"}


**Bills: Major Category classification**

* `Major2`: crude categories of type of bill, where
  - 1 = Economy (1=Macro, 4=Agriculture, 5=Labor,8=Energy,15=Domestic Commerce,17=Tech,18=Foreign Trade,19=International), 
  - 2 = Legal (2=Civil Rights,9=Immigration,12=Law&Crime)
  - 3 = Social programs/Public goods (3=Health,6=Education,7=Environment, 10=Transportation,13=Social Welfare,14=Housing, 21=Public lands,23=Culture)
  - 4 = Security (16=Defense)
  - 5 = Gov operations (20=Gov operations)
  - 6 = Other (all others)
  

```{r,echo=TRUE,eval=FALSE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="as.factor(Major2)",family=2, groupassign="expected")
```

**Bills: Sponsor Ideology, Dimension 1**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="billsponsor_ideol1",family=2)
```

**Bills: Sponsor Ideology, Dimension 2**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model107,cov="billsponsor_ideol2",family=2)
```

**Bills: Sponsor Party**

```{r,echo=TRUE,eval=FALSE,warning=FALSE,message=FALSE}
covGroupB(fm=model107, cov="billsponsor_party", family=2, groupassign="expected")
```

<!-- ### Node/Edge effect plots -->

<!-- What happens if we shift by -1 sd in ideology 1 for senators? (more liberal)? -->

<!-- ```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE} -->
<!-- model<-readRDS("congress107results/comodel-k34_B.rds") -->
<!-- #pred<-predict.mmsbmB(model,type="response",parametric_mm=TRUE,forecast=FALSE) ##CHECK :Error in is.factor(x) : object 'party' not found  -->

<!-- #Ideology moves up by -1 sd (liberal) -->
<!-- fx1<-covFXB(model, cov1="ideol1", shift=-sd(senate107$ideol1) , max.val=FALSE) -->
<!-- print(fx1$`Overall Avg. Effect of ideol1`) -->
<!-- #print(fx1$`Avg. Effect of ideol1 by Time`) -->
<!-- ``` -->

<!-- **Node effect** -->
<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 10, fig.width = 10, fig.align = "center"} -->
<!-- fx1<-covFXB(model107,cov1="ideol1",cov2=NULL,shift=-sd(senate107$ideol1), max.val=FALSE) -->


<!-- plot.mmsbmB(model107,type="effect", FX=fx1, family = 1 -->
<!--             ,nodelabel = sapply(strsplit(as.character(senate107$labels), split=',', fixed=TRUE), function(x) (x[1]))) -->
<!-- ``` -->

<!-- <!-- **Edge effect** --> -->
<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 10, fig.width = 10, fig.align = "center"} -->

<!-- plot.mmsbmB(model107,type="effectchange", FX=fx1, family = 1 -->
<!--             ,nodelabel = sapply(strsplit(as.character(senate107$labels), split=',', fixed=TRUE), function(x) (x[1]))) -->
<!-- ``` -->


### Bipartite graphs

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE}
#sociomatrix
dyad.data_full<-readRDS(file="cosponsor_data/dyad-data-107-FULL.rds")
n_1<-length(unique(dyad.data_full$node1))
n_2<-length(unique(dyad.data_full$node2))
socio<-matrix(NA,nrow=n_1,ncol=n_2)
for(i in 1:n_1){
   for(j in 1:n_2){
     cat("i,j=",i,j,"\n")
     socio[i,j]<-dyad.data_full$Y[which(dyad.data_full$node1==i & dyad.data_full$node2==j)]
   }
 }
 socio<-as.data.frame(socio)
rownames(socio)<-senate$labels
colnames(socio)<-bills$billnum
saveRDS(socio,file="congress107results/sociomatrix.rds")
socio<-readRDS(socio,file="congress107results/sociomatrix.rds")
#order by ideol dim 1
tmp_senate<-senate[order(senate$ideol1),]
tmp_bills<-bills[order(bills$billsponsor_ideol1),]
socio<-socio[match(tmp_senate$labels,rownames(socio)),]
socio<-socio[,match(colnames(socio),tmp_bills$billnum)]
saveRDS(socio,file="congress107results/sociomatrix_ideolorder.rds")
```

**Degree distribution of full bipartite**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
socio<-readRDS("congress107results/sociomatrix_ideolorder.rds") #higher level nodes are in columns (bills), lower level nodes in rows (senators)
# Now, take a look at the scores:
degree.s.n <- (rowSums(as.matrix(socio)))/dim(as.matrix(socio))[2] # degree for the first node set.
tmp<-degree.s.n%*% t(model107$`MixedMembership 1`)
colnames(tmp)<-c("group 1", "group 2", "group 3")
kable(tmp,caption="Senators: Degree for each group",digits=2)
degree.s.m <- (colSums(as.matrix(socio)))/dim(as.matrix(socio))[1] # degree for the second node set.
tmp<-degree.s.m%*% t(model107$`MixedMembership 2`)
colnames(tmp)<-c("group 1", "group 2", "group 3","group 4")
kable(tmp,caption="Bills: Degree for each group",digits=2)
##
```

**Bipartite graph visualization:**

* 200 randomly drawn bills, all senators
* Bill labels are sorted ideology most negative on L (liberal) and most positive on R (conservative)
* Colored in "blue" for Democrat sponsored, and "red" for Republican sponsored
* Senators sorted by ideology as well Left to Right and colored by their party ID. 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_bill_sample<-200
tmp_senate107<-senate107[order(senate107$ideol1),]
tmp_bills107<-bills107[order(bills107$billsponsor_ideol1),]
#higher=col=bills,lower=row=senators
tmp_bills107$high_bills_col<-ifelse(tmp_bills107$billsponsor_party=="Democrat","dodgerblue1","firebrick2")
tmp_senate107$low_senators_col<-ifelse(tmp_senate107$party=="Democrat","dodgerblue1","firebrick2")
set.seed(6102020)
bill_sample<-sample(ncol(socio),n_bill_sample,replace=FALSE)
bill_sample_data<-tmp_bills107[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are
bill_sample_data<-bill_sample_data[order(bill_sample_data$billsponsor_ideol1),]

plot1<-plotwebB(socio[,match(bill_sample_data$billnum,colnames(socio))], text.high.col=bill_sample_data$high_bills_col
        , text.low.col=tmp_senate107$low_senators_col
        ,method="cca"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        #,party_color_info=data.frame(name=tmp_senate107$labels,party=tmp_senate107$party)
        ,bills_color_info=data.frame(name=bill_sample_data$billnum, party=bill_sample_data$billsponsor_party)
        )
#bipartite_col_25bills.pdf
```

**Bipartite sociomatrix visualization:**

* Senator rows
* Bill columns (random draw of 100)
* sorted by row/colSums

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_bill_sample<-100
set.seed(6102020)
bill_sample<-sample(ncol(socio),n_bill_sample,replace=FALSE)
bill_sample_data<-tmp_bills107[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are
visweb(socio[,match(bill_sample_data$billnum,colnames(socio))]
       #,type="none" #nested sorted by row/colSums,#diagonal highest # of interactiosn appear in diagonal
       ,labsize=2
       )
```

**Bipartite graph: Splitting bills by sponsoring party**

**Democrat sponsored bill**

* 100 randomly drawn (democrat sponsored) bills, all senators 
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_sample_bills1<-100
n_sample_bills2<-100
#color the edges by partisanship of senator, and to create two separate plots all with all senators, one with bills sponsored by dems, and another with bills sponsored by reps. Then you can create the same plots but colored by membership of bills
#bills sponsored by Dems
dem_socio<-socio[,match(tmp_bills107$billnum[which(tmp_bills107$billsponsor_party=="Democrat")],colnames(socio))] #cols of socio for democrat bills
  #sample from the bills
  set.seed(6102020)
  bill_sample<-sample(colnames(dem_socio),n_sample_bills1,replace=FALSE)
  dem_bill_sample_data<-tmp_bills107[which(tmp_bills107$billnum%in%bill_sample),]
rep_socio<-socio[,match(tmp_bills107$billnum[which(tmp_bills107$billsponsor_party=="Republican")],colnames(socio))] #cols of socio for republican bills
  #sample from the bills
  set.seed(6102020)
  bill_sample<-sample(colnames(rep_socio),n_sample_bills2,replace=FALSE)
  rep_bill_sample_data<-tmp_bills107[which(tmp_bills107$billnum%in%bill_sample),]
#Democrat-Sponsored Bills
plotwebB(dem_socio[,match(dem_bill_sample_data$billnum,colnames(dem_socio))],bor.col.interaction ="white"
        , text.high.col="dodgerblue1" #All BLUE
        , text.low.col=tmp_senate107$low_senators_col
        ,method="cca"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        ,party_color_info=data.frame(name=senate107$labels,party=senate107$party)
        )
#bipartite_col_20dembills.pdf
```

**Republican sponsored bill**

* 100 randomly drawn (republican sponsored) bills, all senators 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
#Republican-Sponsored Bills
plotwebB(rep_socio[,match(rep_bill_sample_data$billnum,colnames(rep_socio))]
        , text.high.col="firebrick1" #All RED
        , text.low.col=tmp_senate107$low_senators_col
        ,method="normal"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        ,party_color_info=data.frame(name=senate107$labels,party=senate107$party)
        )
```

# 108th Congressional session

**note data.108**: for orig


```{r, echo=FALSE,eval=FALSE}
dyad.data<-readRDS("tests/cosponsorship/cosponsor_data/dyad-data-108.rds")
senate<-readRDS("tests/cosponsorship/cosponsor_data/senate-108.rds")
bills<-readRDS("tests/cosponsorship/cosponsor_data/bills-108.rds")
node1=nrow(senate)
node2=nrow(bills)
```

Summarizing information on the Congress:

* Number of Democrats, Republicans, Independent
* Number of bills

```{r summary-stat108, echo=FALSE, eval=TRUE}
#senators
#linesep = if (booktabs) c('', '', '', '', '\\addlinespace') else '\\hline'
d<-cbind(c(senate$labels[which(senate$party=="Democrat")][1:25],""),c(senate$labels[which(senate$party=="Democrat")][26:48],rep("",3)),c(senate$labels[which(senate$party=="Republican")][1:25],""),senate$labels[which(senate$party=="Republican")][26:51], c(senate$labels[which(senate$party=="Independent")],rep("",25)))
 kable(d, format="html", booktabs = T, linesep = "",padding=-1L) %>% 
   add_header_above(c("Democrats" = 2, "Republicans" = 2, "Independent" = 1), font_size=12) %>%
   kable_styling(font_size=9, position="center"
                 ,bootstrap_options = "striped") %>%
   column_spec(1:2, width = "15em", bold = FALSE, italic = FALSE, color = "navy") %>%
   column_spec(3:4, width = "15em", bold = FALSE, italic = FALSE, color = "maroon") %>%
   column_spec(5, width = "15em", bold = FALSE, italic = FALSE, color = "darkgray") %>%
  footnote(general = "The only independent in this session was Jim Jeffords. Jeffords served as a Republican up to 2001, and then switched to become an independent after and began caucusing with Democrats.",threeparttable = T)
 
#bills: table in latex (generated using tablesgenerator.com)
 table(bills$billsponsor_party,bills$billtype)
```

```{r summary-stat107, echo=FALSE, eval=TRUE}
d<-cbind(subset(senate,select=c(labels),subset=party=="Democrat")[1:25,],subset(senate,select=c(labels),subset=party=="Democrat")[26:50,],subset(senate,select=c(labels),subset=party=="Republican")[1:25,],subset(senate,select=c(labels),subset=party=="Republican")[26:50,])
#names(d)<-c("Democrat","Democrat","Republican","Republican")
rownames(d)<-NULL
 kable(d, format="html", booktabs = T, linesep = "",padding=-1L) %>% 
   add_header_above(c("Democrats" = 1, "Republicans" = 3), font_size=12) %>%
   kable_styling(font_size=9, position="center"
                 ,bootstrap_options = "striped") %>%
   column_spec(1:2, width = "15em", bold = FALSE, italic = FALSE, color = "navy") %>%
   column_spec(3:4, width = "15em", bold = FALSE, italic = FALSE, color = "maroon") %>%
  footnote(general = "On November 4, 2002, Jesse Ventura appointed Dean Barkley to complete the Senate term of Paul Wellstone, who died in a plane crash on October 25. The appointment was announced during the Senate debate between Republican Norm Coleman and Democrat Walter Mondale, who had taken Wellstone's place on the ballot; Ventura intended to upstage the debate. Barkley served until the 107th United States Congress ended on January 3, 2003, when he was replaced by Coleman, who won the election. Lisa Ann Murkowski replaced Frank Murkowski. She was appointed to the U.S. Senate by her father, who resigned his seat in December 2002 to become the Governor of Alaska. She completed her father's unexpired term, which ended in January 2005. She does not appear in the congressional bills dataset under session 107 and so is omitted.",threeparttable = T)
```


## Estimate the Model

We will be using three data sets

1) `dyad.data`: dyadic level data which is time-dyad level data, with variables for node index for senators (`node1`) and bills (`node2`) the edge value drawn between senator and bill nodes (`Y`), and the time period (here always 1, as we focus on the 107th congressional session only).

2) `senate`: monadic level data measured at the senator-time level, with a variable indicating the node index for senators (`node1`) which directly corresponds with the unique node index for senators in `dyad.data`. The same is true for the `time` variable. Monadic covariates include `seniority`, `ideol1`, `ideol2`, `party`, and `sex`.

3) `bills`: monadic level data measured at the bills-time level, with a variable indicating the node index for senators (`node2`) which directly corresponds with the unique node index for bills in `dyad.data`. The same is true for the `time` variable. Monadic covariates include `private`, `Major` and `Major2` (and `Major3` for alternative variable for classification of bill), as well as covariates on the sponsor of the bill (`billsponsor_seniority`, `billsponsor_ideol1`, `billsponsor_ideol2`, `billsponsor_party`, `billsponsor_sex`).


**Monadic covariates for Senators**

* `seniority`: seniority of the senators
* `ideol1`: ideology dim 1
* `ideol2`: ideology dim 2
* `party` : party label
* `sex` : sex of senator

**Monadic covariates for Bills** 

* `Major2`: crude categories of type of bill, where
  - 1 = Economy (1=Macro, 4=Agriculture, 5=Labor,8=Energy,15=Domestic Commerce,17=Tech,18=Foreign Trade,19=International), 
  - 2 = Legal (2=Civil Rights,9=Immigration,12=Law&Crime)
  - 3 = Social programs/Public goods (3=Health,6=Education,7=Environment, 10=Transportation,13=Social Welfare,14=Housing, 21=Public lands,23=Culture)
  - 4 = Security (16=Defense)
  - 5 = Gov operations (20=Gov operations)
  - 6 = Other (all others)
* `billsponsor_seniority`: seniority of the senator who sponsored the bill
* `billsponsor_ideol1`: ideology dim 1 of the senator who sponsored the bill
* `billsponsor_ideol2`: ideology dim 2 of the senator who sponsored the bill
* `billsponsor_party` : party label of the senator who sponsored the bill
* `billsponsor_sex` : sex of senator who sponsored the bill
* (We don't use the variable `private` because only 5 ones, otherwise all zeros)

Dyadic covariates: 

* `reciprocity`: for a given senator-bill dyad, whether the senator sponsored bills in the previous session that the sponsor of this current bill cosponsored.

Find `k1` and `k2` values such that the AUC is maximized for a small subsample.

```{r,eval=FALSE,echo=TRUE,warning=FALSE,message=FALSE}
dyad.data$tid<-dyad.data$time
senate$tid<-senate$time
bills$tid<-bills$time
set.seed(123)
sample_split_index<-sample(1:node2,node2,replace=FALSE) #sample split based on Family 2
train.data.dyad<- dyad.data[which(dyad.data$node2%in%sample_split_index[1:round(node2*0.1)]),]
test.data.dyad<- dyad.data[which(dyad.data$node2%in%sample_split_index[(round(node2*0.1)+1):round(node2*0.2)]),]
train.data.monad1 <- senate
train.data.monad2 <- bills[which(bills$node2%in%sample_split_index[1:round(node2*0.1)]),]
test.data.monad2 <- bills[which(bills$node2%in%sample_split_index[(round(node2*0.1)+1):round(node2*0.2)]),]

set.seed(123)
mychoiceK<-chooseK(formula.dyad = Y ~ reciprocity_prop0 + lreciprocity_prop,
                    formula.monad1 = ~ seniority + ideol1 + ideol2 + as.factor(party) + sex, #
                    formula.monad2 = ~ as.factor(Major2) + billsponsor_seniority + billsponsor_ideol1 + billsponsor_ideol2 +
                     billsponsor_party + billsponsor_sex,
                    senderID = "node1",
                    receiverID = "node2",
                    nodeID1 = "node1",
                    nodeID2 = "node2",
                    timeID = "time",
                  train.data.dyad = train.data.dyad, 
                  test.data.dyad = test.data.dyad,
                  train.data.monad1 = train.data.monad1, 
                  test.data.monad1 = NULL,
                  train.data.monad2 = train.data.monad2, 
                  test.data.monad2 = test.data.monad2,
                  k1=c(2,3,4), 
                  k2=c(2,3,4),
                  n.hmmstates= 1,
                    mmsbm.control = list(seed=123, spectral = TRUE,
                                         hessian = TRUE,
                                         verbose=TRUE,
                                         vi_iter = 1000,
                                         conv_tol = 1e-6,
                                         bipartite = TRUE
                                   ))
#mychoiceK$bestk: 3 4
saveRDS(mychoiceK,file="cosponsor_data/mychoiceK-108.rds")
```
 
```{r,eval=TRUE,echo=FALSE,warning=FALSE,message=FALSE}
mychoiceK2<-readRDS(file="cosponsor_data/mychoiceK-108.rds")
```

`r mychoiceK2$bestk` is the combination with the highest AUC.

**K1=3, K2=4**
```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE}
#
set.seed(123)
t2<-Sys.time()
co.model1 <- mmsbmB(formula.dyad = Y ~ reciprocity_prop0 + lreciprocity_prop,
                    formula.monad1 = ~ seniority + ideol1 + ideol2 + as.factor(party) + sex, #
                    formula.monad2 = ~ as.factor(Major2) + billsponsor_seniority + billsponsor_ideol1 + 
                        billsponsor_ideol2 + as.factor(billsponsor_party) + billsponsor_sex,
                    senderID = "node1",
                    receiverID = "node2",
                    nodeID1 = "node1",
                    nodeID2 = "node2",
                    timeID = "time",
                    data.dyad = dyad.data,
                    data.monad1 = senate,
                    data.monad2 = bills,
                    n.blocks1 = 3,#blocks for legislators
                    n.blocks2 = 4,#blocks for bills
                    n.hmmstates = 1,
                    directed = TRUE,
                    #nodes2 = node2,
                    #npred2 = 1+5+5,#+1 for intercept
                    mmsbm.control = list(spectral = TRUE,
                                         hessian = TRUE,
                                         verbose=TRUE,
                                         vi_iter = 1000,
                                         conv_tol = 1e-6,
                                         bipartite = TRUE
                                   ))
t2<-Sys.time()-t2
t2
#save(co.model1,file="congress108results/comodel-k33_B.RData") #verB with 0.5 as variance for monadic/beta intercepts, no _B is 1.0 variance
#saveRDS(co.model1,file="congress108results/comodel-k23_B.rds")
saveRDS(co.model1,file="congress108results/comodel-k34_B.rds")
```

20 min.


## Visualization of returned model output

We can look at summaries of the returned information.

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
dyad.data<-readRDS("cosponsor_data/dyad-data-108.rds")
senate<-readRDS("cosponsor_data/senate-108.rds")
bills<-readRDS("cosponsor_data/bills-108.rds")
node1=nrow(senate)
node2=nrow(bills)
```


### Group Memberships

For instance, what is the probability of edges being drawn between the two sets of latent groups? Note we denote the latent groups of first class of nodes (**senators**) by **G**, and the latent groups of second class of nodes (**bills**) by **H**.

**Blockmodel**
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
block<-model$BlockModel
rownames(block)<-c("Senate Group 1","Senate Group 2", "Senate Group 3")
colnames(block)<-c("Bills Group 1","Bills Group 2","Bills Group 3","Bills Group 4")
kable(block,digits=3)
plot.mmsbmB(model,type="block")
```

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
plot.mmsbmB(model,type="groups")
```

Senators (G) in all three latent groups are more likely to form edges with Bills (H) in latent group 4, and all are less likely to form edges with Bills (H) in group 3. 

Senators in G Group 2 are most likely to form edges across all bills latent groups, though have a higher probability of forming an edge with Bill H latent groups 2 and 3. Senators in groups G1 and G3 on the other hand are more likely to form edges with Bill H latent groups 1 and 4, than with Bill H latent groups 2 and 3.



#### Senator latent groups

How are senators clustering in the latent group space? We will visualize via ternary plots as we have estimated a model with 2 latent groups on the senator side.

**Senator Latent Group Plots**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
#TERNARY
 ### call in data again
dyad.data108<-readRDS("cosponsor_data/dyad-data-108.rds")
senate108<-readRDS("cosponsor_data/senate-108.rds")
bills108<-readRDS("cosponsor_data/bills-108.rds")
node1=nrow(senate)
node2=nrow(bills)
model108<-readRDS("congress108results/comodel-k34_B.rds")
###  Congressional latent groups
 dat<-data.frame(name=senate108$labels,party=senate108$party,group1=model108$`MixedMembership 1`[1,]
                    ,group2=model108$`MixedMembership 1`[2,]
                 ,group3=model108$`MixedMembership 1`[3,])
 dat$color<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
 #sort by group probas
 dat<-dat[order(-dat$group1,-dat$group2,-dat$group3),]
 dat$name<-as.vector(dat$name)
#sample from rows of senators because way too many
 #dat<-dat[seq(1,nrow(dat),2),]
 dat$name<-factor(dat$name, levels = dat$name)
 TernaryPlot(atip="Group 1", btip="Group 2", ctip="Group 3", point="up")
 AddToTernary(points, dat[,c("group1","group2","group3")]*100, pch=21, cex=1.5,
              bg=apply(dat[,c("group1","group2","group3")]*100, 1,
                       function (x) rgb(x[3], x[2], x[1], 128, maxColorValue=255)))

dat2<-apply(dat[,c("group1","group2","group3")]*100,1,jitter,amount=5)
AddToTernary(text, t(dat2), dat$name, cex=0.5, font=2, col=dat$color)



# ###  Congressional latent groups
# dat<-data.frame(name=senate$labels,party=senate$party,group1=model$`MixedMembership 1`[1,]
#                    ,group2=model$`MixedMembership 1`[2,])
# dat$pcolor<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
# 
# #sort by group probas
# dat<-dat[order(-dat$group1,-dat$group2),]
# dat$name<-as.vector(dat$name)
# tmp_color<-dat$pcolor
# dat %>%
#   arrange(group1) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
#   mutate(name=factor(name, levels=name)) %>%   # This trick update the factor levels
#   ggplot( aes(x=name, y=group1)) +
#     geom_segment(aes(xend=name, yend=0),color="gray",alpha=0.5) +
#     geom_point(size=3,aes(colour = factor(name))) +
#     coord_flip() +
#     theme_bw() + theme(legend.position="none") + 
#     xlab("") + ylab("Probability in Group 1") + scale_colour_manual(values = rev(tmp_color))
```

Senators latent groups 1- 3 are mostly composed of Republican senators (group 1 with more members and some mixed in Democrats, while Group 3 a smaller group of nearly all Republicans), while Group 2 is Democrats. Latent group memberships are well sorted into the three corners of the ternary plot.

**Top 10 members of senator latent groups, by probas**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"}
plot_data<-topmmB(model108$`MixedMembership 1`,n=10,names=senate108$labels)
vars<-c("names","probability")
rownames(plot_data)<-NULL
temp<-as.data.frame(cbind(subset(plot_data,group==1)[,vars],subset(plot_data,group==2)[,vars]
            ,subset(plot_data,group==3)[,vars]))#,subset(plot_data,group==4)[,vars]))
colnames(temp)=c("Names","Group 1","Names","Group 2","Names","Group 3")#,"Names","Group 4")
kable(temp)
```
 
#### Bills latent groups

How are bills clustering in the latent group space? 

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 8, fig.width = 8, fig.align = "center"}
### call in data again
dyad.data<-readRDS("cosponsor_data/dyad-data-108.rds")
senate<-readRDS("cosponsor_data/senate-108.rds")
bills<-readRDS("cosponsor_data/bills-108.rds")
node1=nrow(senate)
node2=nrow(bills)
model<-readRDS("congress108results/comodel-k34_B.rds")

#TERNARY: not possible with 4 latent groups
###  Congressional latent groups
 dat<-data.frame(name=bills$billnum,party=bills$billsponsor_party,group1=model$`MixedMembership 2`[1,]
                    ,group2=model$`MixedMembership 2`[2,] ,group3=model$`MixedMembership 2`[3,])
dat$color<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
# #sort by group probas
dat<-dat[order(-dat$group1,-dat$group2,-dat$group3),]
dat$name<-as.vector(dat$name)
#sample from rows of bills because way too many
dat<-dat[seq(1,nrow(dat),2),]
dat$name<-factor(dat$name, levels = dat$name)
TernaryPlot(atip="Group 1", btip="Group 2", ctip="Group 3", point="up")
AddToTernary(points, dat[,c("group1","group2","group3")]*100, pch=21, cex=1.5, 
              bg=apply(dat[,c("group1","group2","group3")]*100, 1,
                       function (x) rgb(x[3], x[2], x[1], 128, maxColorValue=255)))

dat2<-apply(dat[,c("group1","group2","group3")]*100,1,jitter,amount=5)
AddToTernary(text, t(dat2), dat$name, cex=0.5, font=2, col=dat$color)



dat<-data.frame(name=bills$billnum,type=bills$billtype,category=bills$Major2
                ,seniority=bills$billsponsor_seniority
                ,ideol1=bills$billsponsor_ideol1,ideol2=bills$billsponsor_ideol2
                ,party=bills$billsponsor_party,sex=bills$billsponsor_sex
                ,group1=model$`MixedMembership 2`[1,]
                   ,group2=model$`MixedMembership 2`[2,])
dat$color<-ifelse(dat$category==1,"darkslateblue"           #Economy
                  ,ifelse(dat$category==2,"darkgoldenrod1"  #Intl
                  ,ifelse(dat$category==3,"forestgreen"     #Social programs/Public goods
                  ,ifelse(dat$category==4,"firebrick1"      #Security
                  ,ifelse(dat$category==5,"purple"          #gov programs
                          , "gray")                                 #Other
                          ))))
dat$color_party<-ifelse(dat$party=="Democrat","darkslateblue",ifelse(dat$party=="Republican","firebrick4","gray"))
#sort by group probas
dat<-dat[order(-dat$group1,-dat$group2),]
#sample from rows of bills because way too many
set.seed(12345)
dat<-dat[seq(1,nrow(dat),50),]
dat$name<-as.vector(dat$name)
tmp_color<-dat$color_party
tmp_coloraxis<-dat$color
dat %>%
  arrange(group1) %>%    # First sort by val. This sort the dataframe but NOT the factor levels
  mutate(name=factor(name, levels=name)) %>%   # This trick update the factor levels
  ggplot( aes(x=name, y=group1)) +
    geom_segment(aes(xend=name, yend=0),color="gray",alpha=0.75) +
    geom_point(size=3,aes(colour = factor(name)),alpha=0.5) +
    coord_flip() +
    theme_bw() + theme(legend.position="none") + 
    xlab("") + ylab("Probability in Group 1") + scale_colour_manual(values = rev(tmp_color)) +
    theme(axis.text.y = element_text(angle = 45, hjust = 1, colour = tmp_coloraxis))
```


What are the top bills?
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
plot_data<-topmmB(model$`MixedMembership 2`,n=20,names=bills$billnum)
vars<-c("names","probability")
kable(cbind(subset(plot_data,group==1)[,vars],subset(plot_data,group==2)[,vars],subset(plot_data,group==3)[,vars],subset(plot_data,group==4)[,vars])
      ,col.names=c("Names","Group 1","Names","Group 2","Names","Group 3","Names","Group 4")
      ,caption="Top 20 members of bills latent groups, by probas"
      )
```

<!-- * Top Group 1 Bill: S.Res.284 was **A resolution commemorating the life of William V. Roth, Jr., former member of the United States Senate from the State of Delaware.** -->
<!--   - Sponsored by Joe Biden (D) -->
<!-- * Top Group 2 Bill: SN 2758 was the **Legislative Branch Financial Accountability Act of 2004**, which -->
<!--   - Sponsored by Peter Fitzgerald (R) -->
<!--   - Requires the Senate, House of Representatives, [...], U.S. Capitol Police, and any congressional legislative branch entity not required by statute to have annual financial statements independently audited to each have a financial statement prepared in accordance with U.S. generally accepted accounting principles, and have the statement independently audited, for the preceding calendar year covering all such entity's accounts and associated activities. -->
<!-- * Top Group 3 Bill: SN 2088 was the **Fairness and Individual Rights Necessary to Ensure a Stronger Society: Civil Rights Act of 2004** -->
<!--   - Sponsored by Ed Kennedy (D) -->
<!--   -  Amends the Civil Rights Act of 1964, the Education Amendments of 1972, and the Age Discrimination Act of 1975 to set forth requirements for: (1) establishing discrimination based on disparate impact; and (2) rights of action and recovery for unlawful discrimination (intentional or based on disparate impact) and harassment.  -->

Bill specific information: (http://jhfowler.ucsd.edu/cosponsorship.htm)

* HC  House Concurrent Resolutions
* HE 	House Resolutions
* HJ 	House Joint Resolutions
* HR 	House Bills
* HZ 	House Amendments
* SC 	Senate Concurrent Resolutions
* SE 	Senate Resolutions
* SJ 	Senate Joint Resolutions
* SN 	Senate Bills
* SP 	Senate Amendments 


**Group 1**
[Latent group characterized by a large number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and slightly higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate bills.The types of bills most likely to be in this group are ones that are about health services, schools. They are also likely to have (~0 -10 range) numbers of cosponsors .]{color="orange"}

* SN_108_1205: Rural Teacher Housing Act of 2003. Requires the Secretary of Housing and Urban Development to provide funds to an eligible State (with a population of fewer than one million people) to make grants to eligible school districts located within a qualified municipality (with a population of 6,500 or fewer and no direct access to either a State or interstate highway system) within the boundaries of Indian lands, one or more Native villages, or land owned by one or more Village Corporations). (1)
* SN_108_628: Columbia Orbiter Memorial Act. Directs the Secretary of the Army to construct in Arlington National Cemetery, Virginia, a memorial marker honoring the seven members of the crew of the Columbia Orbiter who died on February 1, 2003, during the landing of space shuttle mission STS-107. (4)
* SN_108_931: Federal Land Recreational Visitor Protection Act of 2004. Directs the Secretary of Agriculture to establish an avalanche protection program to: (1) provide early identification of the potential for avalanches that could endanger the safety of recreational users of public land and visitors to units of the National Park System (NPS); and (2) reduce the risks and mitigate the effects of avalanches on visitors, recreational users, neighboring communities, and transportation corridors. (5)
* SN_108_1015: Mosquito Abatement for Safety and Health Act. Amends the Public Health Service Act to authorize the Secretary of Health and Human Services, acting through the Director of the Centers for Disease Control and Prevention, to make grants to States for the purposes of: (1) coordinating mosquito control programs; and (2) assisting States to make grants to localities to conduct assessments regarding the need for control programs and to develop plans for carrying out such programs. Declares that a State may receive only one grant. Directs the Secretary to give preference to States that have one or more localities with high incidences or high risk of mosquito-borne disease or substantial populations of infected mosquitoes. Sets a maximum amount of $10,000 for grants to localities for assessments and plans. (13)
* SN_108_1225: Greater Access to Affordable Pharmaceuticals Act. Amends the Federal Food, Drug, and Cosmetic Act to: (1) limit a brand name drug manufacturer to one Food and Drug Administration (FDA) 30-month stay of competition in a patent infringement suit against a generic drug applicant; (2) permit a generic applicant being sued to file a counterclaim to correct or delete patent information; (3) limit damages that a brand name manufacturer may recover in an instance where such manufacturer failed to file certain patent information; (4) permit a generic drug applicant to seek declaratory judgment regarding patent infringement prior to marketing a drug; (5) forfeit the180-day market exclusivity period for a first generic drug applicant to a subsequent generic applicant if the first applicant engages in certain activities which impede such drug's timely marketing; and (6) permit alternative means to determine bioequivalence for drugs that are not absorbed into the bloodstream. (4)
* SN_108_1248: Individuals with Disabilities Education Improvement Act of 2003. Title I: Amendments to the Individuals With Disabilities Education Act - (Sec. 101) Amends the Individuals with Disabilities Education Act (IDEA) to revise programs and reauthorize appropriations through FY 2009. (14)
* SN_108_15: Project BioShield Act of 2004. Amends the Public Health Service Act to authorize the Secretary of Health and Human Services (the Secretary) to: (1) conduct and support research and development activities regarding qualified countermeasures (a drug, biological product, or device to treat, identify, or prevent harm from any biological, chemical, radiological, or nuclear agent that may cause a public health emergency affecting national security), including by entering into interagency agreements for research and development; and (2) provide that biocontaminant laboratories and specialized research facilities under such agreements shall be available to the Secretary to respond to public health emergencies affecting national security. (15)
* SN_108_1504: Project BioShield Act of 2003.  Amends the Public Health Service Act regarding preparations for public health emergencies affecting national security, including a bioterrorist attack. (1)
* SN_108_1515: Higher Education for Freedom Act. Directs the Secretary of Education to make competitive grants to eligible institutions to prepare elementary, middle, and secondary school history teachers and to strengthen postsecondary programs in fields related to the founding of the United States, free institutions, and Western civilization.(3)
* SN_108_1875: Mental Health Parity Reauthorization Act of 2003. Amends the Employee Retirement Income Security Act of 1974 (ERISA), the Public Health Service Act, and the Internal Revenue Code to extend mental health parity provisions through 2004. BILL (1)
* SN_108_1929: Mental Health Parity Reauthorization Act of 2003. Amends the Employee Retirement Income Security Act of 1974 (ERISA) and the Public Health Service Act to extend mental health parity provisions through 2004. LAW.  (1)
* SN_108_1940: Head Start Improvements for School Readiness Act. Amends the Head Start Act (the Act) to revise and reauthorize Head Start programs. (0)
* SN_108_2061: Healthy Mothers and Healthy Babies Access to Care Act of 2003. (13)
* SN_108_2207: Pregnancy and Trauma Care Access Protection Act of 2004. (7)
* SN_108_2283: State High Risk Pool Funding Extension Act of 2004. Amends the Public Health Service Act to reauthorize funds for States to create high risk health insurance pools and to operate existing State high risk pools. Amends the formula for appropriating funds to States to operate such pools to give one-half of the funds to eligible States equally and apportion the other half based on the number of uninsured individuals in each State and the number of enrollees in the State's qualified high risk pool. (Currently, all funds are allotted based solely on the number of uninsured individuals in the State.) Authorizes appropriations for the program through FY 2009. (12)
* SN_108_2493: Safe IMPORT Act of 2004. Safe Importation of Medical Products and Other Rx Therapies Act of 2004 or Safe IMPORT Act of 2004 - Amends the Federal Food, Drug, and Cosmetic Act to allow individuals to import Food and Drug Administration (FDA)-approved prescription drugs from Canada for personal use. (8)
* SN_108_2651: A bill to authorize the establishment at Antietam National Battlefield of a memorial to the officers and enlisted men of the Fifth, Sixth, and Ninth New Hampshire Volunteer Infantry Regiments and the First New Hampshire Light Artillery Battery who fought in the Battle of Antietam on September 17, 1862, and for other purposes. (1)
* SN_108_2710: National Health Information Technology Adoption Act. (3)
* SN_108_2877: Taxpayer-Teacher Protection Act of 2004. Amends the Higher Education Act of 1965 to: (1) reduce certain special allowance payments to holders of student loans; and (2) provide for additional amounts of student loan forgiveness for certain elementary or secondary school teachers of mathematics, science, or special education. (3)
* SN_108_2940: Act for Elder Justice. Amends the Older Americans Act of 1965 (OAA) to authorize the Secretary of Health and Human Services to establish or designate within the Administration on Aging an Office of Elder Abuse Prevention and Services. Makes it the duty of the Assistant Secretary for Aging, acting through the head of such Office, to develop and implement policy and a long-term plan to carry out elder justice programs and activities. (0)

**Group 2**
[Latent group characterized by a smaller number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about commemorations/celebrations, government (public works, pay sched, funding for DEA, federal health benefits). They are also likely to have (~0-70 wide range) numbers of cosponsors .]{color="orange"}

* SN_108_2808: Celebrate the United States Constitution Day Act. (2)
* SN_108_66: A bill to amend title 5, United States Code, to require the issuance of a prisoner-of-war medal to civilian employees of the Federal Government who are forcibly detained or interned by an enemy government or a hostile force under wartime conditions. (0)
* SN_108_663: A bill for the relief of the Pottawatomi Nation in Canada for settlement of certain claims against the United States. (0)
* SN_108_70: A bill to restore the traditional day of observance of Memorial Day, and for other purposes. (0)
* SN_108_1783: Federal Employee Commuter Benefits Act of 2003. (3)
* SN_108_498: A bill to authorize the President to posthumously award a gold medal on behalf of Congress to Joseph A. De Laine in recognition of his contributions to the Nation. (80)
* SN_108_592: Save American Manufacturing Act of 2003. Establishes within the Department of Commerce an Office of Manufacturing which shall be responsible, among other things, for developing policies to preserve and enhance the industrial base of the United States. (1)
* SN_108_2568: Benjamin Franklin Commemorative Coin Act. (69)
* SN_108_2619: A bill to designate the annex to the E. Barrett Prettyman Federal Building and United States Courthouse located at 333 Constitution Ave. Northwest in Washington, District of Columbia, as the "Judge William B. Bryant Annex to the E. Barrett Prettyman Federal Building and United States Courthouse". (1)
* SN_108_2738: Samuel de Champlain 400th Commemoration Commission Act of 2004. (0)
* SN_108_1923: National Film Preservation Act of 2003. (1)
* SN_108_1145: A bill to designate the facility of the United States Postal Service located at 120 Baldwin Avenue in Paia, Maui, Hawaii, as the "Patsy Takemoto Mink Post Office Building". (1)
* SN_108_1369: A bill to ensure that prescription drug benefits offered to medicare eligible enrollees in the Federal Employees Health Benefits Program are at least equal to the actuarial value of the prescription drug benefits offered to enrollees under the plan generally. (14)
* SN_108_2322: A bill to amend chapter 90 of title 5, United States Code, to include employees of the District of Columbia courts as participants in long term care insurance for Federal employees. (1)
* SN_108_589: Homeland Security Federal Workforce Act of 2003. Title I: Pilot Program for Student Loan Repayment for Federal Employees in National Security Positions. Title II: Fellowships for Graduate Students to Enter Federal Service. (8)
* SN_108_678: Postmasters Equity Act of 2003. Amends Federal law to authorize an organization (other than an organization representing supervisors) that represents at least 20 percent of certain postmasters to participate directly in the planning and development of pay policies and schedules, and fringe benefit programs, and other programs relating to supervisory and other managerial employees. (39)
* SN_108_319: Federal Employees Health Benefits Improvement Act of 2003. Increases the biweekly contribution payable by the Government for a Federal employee or annuitant enrolled in a Federal employee health insurance plan. (3)
* SN_108_819: Law Enforcement Officers Retirement Equity Act . (3)
* SN_108_2081: Dawson Family Community Protection Act. Amends the Office of National Drug Control Policy Act Reauthorization Act of 1998 to authorize appropriations to be used in high intensity drug trafficking areas with severe neighborhood safety and illegal drug distribution problems to: (1) ensure the safety of neighborhoods and the protection of communities, including the prevention of intimidation of potential witnesses; and (2) combat illegal drug trafficking through methods the Director of National Drug Control Policy considers appropriate, such as establishing or operating a toll-free telephone hotline for the public to provide information about illegal drug-related activities. (3)
* SN_108_2612: Federal Law Enforcement Pension Adjustment Equity Act of 2004. Amends the Law Enforcement Pay Equity Act of 2000 to repeal a prohibition against treatment as an increase in salary, for purposes of increased annuitant pension benefits, of the conversion of positions and members of the U.S. Park Police and the Secret Service Uniformed Division to a new salary schedule, and the associated initial adjustments in basic pay rates. (Thus permits cost-of-living adjustments in pension benefits for annuitants of the U.S. Park Police and the U.S. Secret Service Uniformed Division.) (1)

**Group 3**
[Latent group characterized by a smaller number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about armed services/forces, security, giving jurisdiction to federal agencies.  They are also likely to have (~0-10 medium range) numbers of cosponsors .]{color="orange"}

* SN_108_1754: Electric Reliability Security Act of 2003. Amends the Federal Power Act (FPA) to grant the Federal Energy Regulatory Commission (FERC) jurisdiction over a domestic electric reliability organization, any regional entities, and all users, owners and operators of the bulk power system for purposes of approving reliability standards. (2)
* SN_108_2840: National Intelligence Reform Act of 2004. (0)
* SN_108_1073: Homeland Security Grant Coordination and Simplification Act of 2003. (2)
* SN_108_2635:  A bill to establish an intergovernmental grant program to identify and develop homeland security information, equipment, capabilities, technologies, and services to further the homeland security needs of the United States and to address the homeland security needs of Federal, State, and local governments. (3)
* SN_108_812: A bill to amend section 16131 of title 10, United States Code, to increase rates of educational assistance under the program of educational assistance for members of the Selected Reserve. (4)
* SN_108_704: A bill to amend title 10, United States Code, to increase the amount of the death gratuity payable with respect to deceased members of the Armed Forces. (4)
* SN_108_1166: S.1166 — 108th Congress (2003-2004) National Security Personnel System Act. Authorizes the Secretary of Defense to establish a human resources management system, to be referred to as the National Security Personnel System (the System), for some or all organizational or functional units of the Department of Defense (DOD). Excludes specified DOD research and laboratory facilities from the System. Sets forth System requirements. (5)
* SN_108_1612: Homeland Security Technology Improvement Act of 2004. (10)
* SN_108_2845: Intelligence Reform and Terrorism Prevention Act of 2004. (10)
* SN_108_838: A bill to waive the limitation on the use of funds appropriated for the Homeland Security Grant Program. (12)
* SN_108_1245: Homeland Security Grant Enhancement Act of 2003. (29)
* SN_108_1357: Military Construction Appropriations Act, 2004. (0)
* SN_108_2674: Military Construction Appropriations Act, 2005. (0)
* SN_108_949: Overseas Military Facility Structure Review Act of 2003. (2)
* SN_108_2956: Disabled Veterans Transition Assistance Act of 2004. (2)
* SN_108_3002: Disabled Veterans Transition Assistance Act of 2004. (2)
* SN_108_1250: Enhanced 911 Emergency Communications Act of 2003. (4)
* SN_108_2982: S.2982 — 108th Congress (2003-2004) A bill to amend title 38, United States Code, to make a stillborn child an insurable dependent for purposes of the Servicemembers' Group Life Insurance program. (0)
* SN_108_2450: Korea Defense Service Combat Recognition Act. (1)
* SN_108_2196: A bill to amend title 38, United States Code, to clarify that per diem payments by the Department of Veterans Affairs for the care of veterans in State homes shall not be used to offset payments that are made under the medicaid program for the purpose of assisting veterans. (2)

**Group 4**
[Latent group characterized by a larger number of bills with high probability in group -- but lower likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate resolutions of different types. The types of resolutions most likely to be in this group are ones that are about norms (performative and otherwise).  They are also likely to have (~0-~10 range ) numbers of cosponsors .]{color="orange"}

* SC_108_114: A concurrent resolution concerning the importance of the distribution of food in schools to hungry or malnourished children around the world. (1)
* SJ_108_25: A joint resolution proposing an amendment to the Constitution of the United States relative to the line item veto. (0)
* SC_108_103: A concurrent resolution honoring the contribution of the women, symbolized by "Rosie the Riveter", who served on the homefront during World War II, and for other purposes. (14)
* SE_108_112: A resolution designating April 11th, 2003, as "National Youth Service Day", and for other purposes. (20)
* SE_108_185: A resolution expressing the sense of the Senate with respect to raising awareness and encouraging education about safety on the Internet and supporting the goals and ideals of National Internet Safety Month. (2)
* SE_108_220: A resolution designating the ninth day of September of each year as "National Fetal Alcohol Syndrome Awareness Day". (1)
* SE_108_242: A resolution to express the sense of the Senate concerning the do-not-call registry. (0)
* SE_108_337: A resolution expressing the appreciation of the Senate for the Paralyzed Veterans of America. (12)
* SE_108_338: A resolution calling on the President to designate April 16, 2004, as National Youth Service Day, and for other purposes. (27)
* SE_108_390: A resolution designating September 9, 2004, as "National Fetal Alcohol Spectrum Disorders Day". (1)
* SE_108_455: A resolution supporting the goals of Red Ribbon Week. (7)
* SE_108_468:  resolution designating November 7, 2004, as "National Native American Veterans Day" to honor the service of Native Americans in the United States Armed Forces and the contribution of Native Americans to the defense of the United States. (2)
* SE_108_71: S.Res.71 — 108th Congress (2003-2004) A resolution expressing the support for the Pledge of Allegiance. (47)
* SE_108_35: An original resolution authorizing expenditures by the Committee on Banking, Housing, and Urban Affairs. (0)
* SJ_108_29: A joint resolution proposing an amendment to the Constitution of the United States which requires (except during time of war and subject to suspension by the Congress) that the total amount of money expended by the United States during any fiscal year not exceed the amount of certain revenue received by the United States during such fiscal year and not exceed 20 per centum of the gross national product of the United States during the previous calendar year. (0)
* SC_108_89: A concurrent resolution expressing the sense of the Congress with respect to the continuity of the Presidency. (1)
* SE_108_166: A resolution recognizing the United States Air Force's Air Force News Agency on the occasion of its 25th anniversary and honoring the Air Force personnel who have served the Nation while assigned to that agency. (0)
* SE_108_171: A resolution recognizing that the San Antonio Spurs are the 2002-2003 National Basketball Association champions and congratulating the team for its outstanding excellence, discipline, and dominance. (1)
* SE_108_378: A resolution designating June 14, 2004, as "National Pledge of Allegiance to the Flag Day". (6)
* SE_108_413: A resolution encouraging States to consider adopting comprehensive legislation to combat human trafficking and slavery and recognizing the many efforts made to combat human trafficking and slavery. (4)

### Dyadic predictors

We use a sponsor-cosponsor reciprocity variable `lreciprocity_prop` as a dyadic predictor. The variable takes the number of times the senator (node 1) has sponsored a bill that was cosponsored by (node 2) in the previous session 107 over a denominator of the total number of times the senator (node 1) sponsored bills in the previous session. 

Below is the adjacency matrix for reciprocity  between row Senators of Congress 108 and column Senators of Congress 107 (only showing senators who appear in 107 and also appear in 108 for columns). 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE, fig.height = 8, fig.width = 8, fig.align = "center"}
sponsor_history108<-readRDS(file="cosponsor_data/sponsor_history108.rds") #save cosponsorship history info
sub_sponsor_history108<-sponsor_history108[,which(rownames(sponsor_history108)%in%colnames(sponsor_history108))]

plot.sociomatrix(sub_sponsor_history108,drawlab=FALSE,cex.lab=0.5,col.lab="dodgerblue4")

summary108<-summary.mmsbmB(model108)
summary108$`Dyadic Coefficients`
```

[The estimated coefficient on `lreciprocity_prop` is `r round(model108$DyadCoef[2],3)`. When facing a bill today, a senator who has had a sponsorship history with the senator-sponsor is more likely to cosponsor today's bill.  (conditional on having any non-zero sponsorship history). The coefficient estimated on the binary variable for `reciprocity_prop0` (if not zero then 1, if zero then 0) is `r round(model108$DyadCoef[1],3)`.]{color="orange"}


### Senator predictors

We might be interested in seeing how monadic predictors at the senator level are distributed for each of the groups:

**Senator Monadic Predictors**
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
m<-readRDS("congress108results/comodel-k34_B.rds")
coef1<-as.matrix(m$MonadCoef1[,,1])
colnames(coef1)<-c("Senate Group 1","Senate Group 2", "Senate Group 3")
rownames(coef1)<-c("Intercept","Seniority","Ideol1","Ideol2","Independent","Republican","Male")
kable(coef1,digits=3)
```

Senators in groups 1 and 3 are more likely to score positively (or closer to 0) on `ideol1`, be Republicans, with group 1 as more extreme than group 3. Senators with higher membership probabilities in group 2 are more likely to score negatively on `ideol1` and be Democrat and female. 

**Senator: Ideology, Dimension 1**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=m,cov="ideol1",family=1)
```

**Senator: Ideology, Dimension 2**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=m,cov="ideol2",family=1)
```

**Senator: Seniority**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=m,cov="seniority",family=1)
```

**Senator: Party**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=m,cov="as.factor(party)",family=1)
```

**Senator: Sex**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=m,cov="sex",family=1)
```

### Bills predictors

**Bills Monadic Predictors**
```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
coef1<-as.matrix(model$MonadCoef2[,,1])
colnames(coef1)<-c("Bills Group 1","Bills Group 2", "Bills Group 3", "Bills Group 4")
rownames(coef1)<-c("Intercept","Major2:2","Major2:3","Major2:4","Major2:5","Major2:6"
                   ,"Sponsor Seniority","Sponsor Ideol1","Sponsor Ideol2","Sponsor Independent","Sponsor Republican","Male")
kable(coef1,digits=3)
```

[Group 1: Latent group characterized by a large number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and slightly higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate bills.The types of bills most likely to be in this group are ones that are about health services, schools. They are also likely to have (~0 -10 range) numbers of cosponsors .]{color="orange"}
[Group 2: Latent group characterized by a smaller number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Democrats, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about commemorations/celebrations, government (public works, pay sched, funding for DEA, federal health benefits). They are also likely to have (~0-70 wide range) numbers of cosponsors .]{color="orange"}
[Group 3: Latent group characterized by a smaller number of bills with high probability in group -- but low likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate bills. The types of bills most likely to be in this group are ones that are about armed services/forces, security, giving jurisdiction to federal agencies.  They are also likely to have (~0-10 medium range) numbers of cosponsors .]{color="orange"}
[Group 4: Latent group characterized by a larger number of bills with high probability in group -- but lower likelihood of edge formation with senate latent groups 1 and 3, and much higher edge formation likelihood with senators in G latent group 2. Bills that have the highest probability of being in this group are sponsored by Republicans, and are more likely to be Senate resolutions of different types. The types of resolutions most likely to be in this group are ones that are about norms (performative and otherwise).  They are also likely to have (~0-~10 range ) numbers of cosponsors .]{color="orange"}

**Bills: Major Category classification**

* `Major2`: crude categories of type of bill, where
  - 1 = Economy (1=Macro, 4=Agriculture, 5=Labor,8=Energy,15=Domestic Commerce,17=Tech,18=Foreign Trade,19=International), 
  - 2 = Legal (2=Civil Rights,9=Immigration,12=Law&Crime)
  - 3 = Social programs/Public goods (3=Health,6=Education,7=Environment, 10=Transportation,13=Social Welfare,14=Housing, 21=Public lands,23=Culture)
  - 4 = Security (16=Defense)
  - 5 = Gov operations (20=Gov operations)
  - 6 = Other (all others)

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
#Categorical variables: Grouped/Stacked Barplots
groups<-apply(model$`MixedMembership 2`,2,which.max)
group<-as.factor(rep(c(1,2,3, 4),length(levels(bills$Major2))))
p <-c(prop.table(table(groups,bills$Major2),1))#vectorize col major, row prop: proportion of each categ in latent group
value<-rep(levels(bills$Major2),each=length(unique(group)))#repeat by number of groups
value_type<-ifelse(value==1,"Economy",ifelse(value==2,"Legal",ifelse(value==3,"Social/Public",ifelse(value==4,"Security",ifelse(value==5,"Gov oper","Other")))))
data <- data.frame(group,p,value,value_type)
pos<-"fill"#"dodge"/"stack"/"fill"
ggplot(data, aes(fill=group, y=value_type, x=p)) + ggtitle("Group proportions in each Major category") +
    geom_bar(position=pos, stat="identity") + theme_bw() + scale_fill_viridis(discrete = T, option = "E", alpha=0.5)

covGroupB(fm=model,cov="as.factor(Major2)",family=2, groupassign="expected")
```

**Bills: Sponsor Ideology, Dimension 1**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
model<-readRDS("congress108results/comodel-k34_B.rds")
covGroupB(fm=model,cov="billsponsor_ideol1",family=2, groupassign="expected")
```

**Bills: Sponsor Ideology, Dimension 2**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model,cov="billsponsor_ideol2",family=2, groupassign="expected")
```

**Bills: Sponsor Party**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
covGroupB(fm=model,cov="as.factor(billsponsor_party)",family=2, groupassign="expected")
```

### Dyadic predictors

We use a sponsor-cosponsor reciprocity variable `lreciprocity_prop` as a dyadic predictor. The variable takes the number of times the senator (node 1) has sponsored a bill that was cosponsored by (node 2) in the previous session 106 over a denominator of the total number of times the senator (node 1) sponsored bills in the previous session. 

Below is the adjacency matrix for reciprocity  between row Senators of Congress 108 and column Senators of Congress 107 (only showing senators who appear in 107 and also appear in 108 for columns). 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE, fig.height = 8, fig.width = 8, fig.align = "center"}
sponsor_history108<-readRDS(file="cosponsor_data/sponsor_history108.rds") #save cosponsorship history info
sub_sponsor_history108<-sponsor_history108[,which(rownames(sponsor_history108)%in%colnames(sponsor_history108))]

plot.sociomatrix(sub_sponsor_history108,drawlab=FALSE,cex.lab=0.5,col.lab="dodgerblue4")

model<-readRDS("congress108results/comodel-k34_B.rds")
```

[The estimated coefficient on `lreciprocity_prop` is `r round(model$DyadCoef[2],3)`. When facing a bill today, a senator who has had a sponsorship history with the senator-sponsor is more likely to cosponsor today's bill.  (conditional on having any non-zero sponsorship history). The coefficient estimated on the binary variable for `reciprocity_prop0` (if not zero then 1, if zero then 0) is `r round(model$DyadCoef[1],3)`.]{color="maroon"}

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
summary.mmsbmB(model)
```



<!-- ### Node/Edge effect plots -->

<!-- What happens when we shift Senator ideology by -1 sd (more liberal)? -->
<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- #pred<-predict.mmsbmB(model,type="response",parametric_mm=TRUE,forecast=FALSE) -->

<!-- #Ideology moves up by -1 sd (liberal) -->
<!-- fx1<-covFXB(model, cov1="ideol1", shift=-sd(senate$ideol1) -->
<!--             , max.val=FALSE) -->
<!-- print(fx1$`Overall Avg. Effect of ideol1`) -->
<!-- #print(fx1$`Avg. Effect of ideol1 by Time`) -->
<!-- ``` -->

<!-- **Node effect** -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 10, fig.width = 10, fig.align = "center"} -->
<!-- fx1<-covFXB(model,cov1="ideol1",cov2=NULL,shift=-sd(senate$ideol1), max.val=FALSE) -->


<!-- plot.mmsbmB(model,type="effect", FX=fx1, family = 1 -->
<!--             ,nodelabel = sapply(strsplit(as.character(senate$labels), split=',', fixed=TRUE), function(x) (x[1]))) -->
<!-- ``` -->

<!-- **Edge effect** -->
<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 10, fig.width = 10, fig.align = "center"} -->
<!-- plot.mmsbmB(model,type="effectchange", FX=fx1, family = 1 -->
<!--             ,nodelabel = sapply(strsplit(as.character(senate$labels), split=',', fixed=TRUE), function(x) (x[1]))) -->
<!-- ``` -->

<!-- <!-- ### Simulate #### NEEDS FIXING simulate.mmsbmB --> -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- res<-simulate.mmsbmB(model) -->
<!-- ``` -->


<!-- <!-- Out of sample prediction: --> -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- #Randomly sample training and testing via sociomatrix-bills -->
<!--   #remove specific node2 -->
<!-- set.seed(123) -->
<!-- ind<-sample(unique(dyad.data$node2),length(unique(dyad.data$node2))) -->
<!-- n_tr<-round(length(unique(dyad.data$node2))*.8) -->
<!-- n_b<-length(unique(dyad.data$node2)) -->
<!-- dyad.data.train<-subset(dyad.data,node2%in%ind[1:n_tr]) -->
<!-- dyad.data.test<-subset(dyad.data,node2%in%ind[(n_tr+1):length(ind)]) -->
<!-- bills.train<-subset(bills,node2%in%ind[1:n_tr]) -->
<!-- bills.test<-subset(bills,node2%in%ind[(n_tr+1):length(ind)]) -->
<!-- #rename node2 names -->
<!--   #dyad data -->
<!-- node2a<-vector() -->
<!-- times<-c(table(dyad.data.train$node2)) -->
<!-- for(i in 1:n_tr){ -->
<!--   node2a<-c(node2a,rep(i,each=times[i])) -->
<!-- } -->
<!-- dyad.data.train$node2<-node2a -->
<!-- node2a<-vector() -->
<!-- times<-c(table(dyad.data.test$node2)) -->
<!-- for(i in 1:nrow(bills.test)){ -->
<!--   node2a<-c(node2a,rep((n_tr+i),each=times[i])) -->
<!-- } -->
<!-- dyad.data.test$node2<-node2a -->
<!--   #bills data -->
<!-- bills.train$node2<-1:n_tr -->
<!-- bills.test$node2<-(n_tr+1):n_b -->
<!-- #senate data kept as is -->

<!-- #Train model -->
<!-- #K1=K2=3 -->
<!-- train.model <- mmsbm(formula.dyad = Y ~ 1, -->
<!--                     formula.monad1 = ~ seniority + ideol1 + ideol2 + as.factor(party) + sex, # -->
<!--                     formula.monad2 = ~ as.factor(Major2) + billsponsor_seniority + billsponsor_ideol1 + billsponsor_ideol2 + billsponsor_party + billsponsor_sex, -->
<!--                     senderID = "node1", -->
<!--                     receiverID = "node2", -->
<!--                     nodeID1 = "node1", -->
<!--                     nodeID2 = "node2", -->
<!--                     timeID = "time", -->
<!--                     data.dyad = dyad.data.train, -->
<!--                     data.monad1 = senate, -->
<!--                     data.monad2 = bills.train, -->
<!--                     n.blocks1 = 3,#blocks for legislators -->
<!--                     n.blocks2 = 3,#blocks for bills -->
<!--                     n.hmmstates = 1, -->
<!--                     directed = TRUE, -->
<!--                     nodes2 = node2, -->
<!--                     npred2 = 1+5+5,#+1 for intercept -->
<!--                     mmsbm.control = list(mu_b = c(3, -5), -->
<!--                                          var_b = c(1, 1), -->
<!--                                          var_beta = 1, -->
<!--                                          eta = 1.3, -->
<!--                                          seed = 1234, -->
<!--                                          alpha = 0.5, -->
<!--                                          spectral = TRUE, -->
<!--                                          verbose=TRUE, -->
<!--                                          em_iter = 1000, -->
<!--                                          conv_tol = 1e-4, -->
<!--                                          bipartite = TRUE -->
<!--                                          ,permute = TRUE -->
<!--                                          ,directed = TRUE -->
<!--                     )) -->

<!-- save(train.model,file="congress108results/trainmodel-k33.RData") -->
<!-- ``` -->

### Bipartite graphs

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
m<-readRDS(file="congress108results/comodel-k34_B.rds")#co.model1
#summarize coefficients
#summary(m)
```

```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE}
#sociomatrix
dyad.data_full<-readRDS(file="cosponsor_data/dyad-data-108-FULL.rds")
n_1<-length(unique(dyad.data_full$node1))
n_2<-length(unique(dyad.data_full$node2))
socio<-matrix(NA,nrow=n_1,ncol=n_2)
for(i in 1:n_1){
   for(j in 1:n_2){
     cat("i,j=",i,j,"\n")
     socio[i,j]<-dyad.data_full$Y[which(dyad.data_full$node1==i & dyad.data_full$node2==j)]
   }
 }
 socio<-as.data.frame(socio)
rownames(socio)<-senate$labels
colnames(socio)<-bills$billnum
saveRDS(socio,file="congress108results/sociomatrix.rds")
socio<-readRDS(socio,file="congress108results/sociomatrix.rds")
#order by ideol dim 1
tmp_senate<-senate[order(senate$ideol1),]
tmp_bills<-bills[order(bills$billsponsor_ideol1),]
socio<-socio[match(tmp_senate$labels,rownames(socio)),]
socio<-socio[,match(colnames(socio),tmp_bills$billnum)]
saveRDS(socio,file="congress108results/sociomatrix_ideolorder.rds")
```

**Degree distribution of full bipartite**

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
socio<-readRDS("congress108results/sociomatrix_ideolorder.rds") #higher level nodes are in columns (bills), lower level nodes in rows (senators)
# Now, take a look at the scores:
degree.s.n <- (rowSums(as.matrix(socio)))/dim(as.matrix(socio))[2] # degree for the first node set.
tmp<-degree.s.n%*% t(m$`MixedMembership 1`)
colnames(tmp)<-c("group 1", "group 2","group 3")
kable(tmp,caption="Senators: Degree for each group",digits=2)
degree.s.m <- (colSums(as.matrix(socio)))/dim(as.matrix(socio))[1] # degree for the second node set.
tmp<-degree.s.m%*% t(m$`MixedMembership 2`)
colnames(tmp)<-c("group 1", "group 2","group 3", "group 4")
kable(tmp,caption="Bills: Degree for each group",digits=2)
##
```

**Bipartite graph visualization:**

* 25 randomly drawn bills, all senators
* Bill labels are sorted ideology most negative on L (liberal) and most positive on R (conservative)
* Colored in "blue" for Democrat sponsored, and "red" for Republican sponsored
* Senators sorted by ideology as well Left to Right and colored by their party ID. 
* SN 623 is **A bill to amend the Internal Revenue Code of 1986 to allow Federal civilian and military retirees to pay health insurance premiums on a pretax basis and to allow a deduction for TRICARE supplemental premiums.** -- sponsored by John Warner (R)

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_bill_sample<-25
tmp_senate<-senate[order(senate$ideol1),]
tmp_bills<-bills[order(bills$billsponsor_ideol1),]
#higher=col=bills,lower=row=senators
tmp_bills$high_bills_col<-ifelse(tmp_bills$billsponsor_party=="Democrat","dodgerblue1",ifelse(tmp_bills$billsponsor_party=="Republican","firebrick2","gray"))
tmp_senate$low_senators_col<-ifelse(tmp_senate$party=="Democrat","dodgerblue1",ifelse(tmp_senate$party=="Republican","firebrick2","gray"))
set.seed(6102020)
bill_sample<-sample(ncol(socio),n_bill_sample,replace=FALSE)
bill_sample_data<-tmp_bills[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are
bill_sample_data<-bill_sample_data[order(bill_sample_data$billsponsor_ideol1),]

plotwebB(socio[,match(bill_sample_data$billnum,colnames(socio))], text.high.col=bill_sample_data$high_bills_col
        , text.low.col = tmp_senate$low_senators_col
        ,method="normal"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        #,party_color_info=data.frame(name=tmp_senate$labels,party=tmp_senate$party)
        ,bills_color_info=data.frame(name=bill_sample_data$billnum,party=bill_sample_data$billsponsor_party)
        )
#bipartite_col_25bills.pdf
```

**Bipartite sociomatrix visualization:**

* Senator rows
* Bill columns (random draw of 100)
* sorted by row/colSums

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_bill_sample<-100
set.seed(6102020)
bill_sample<-sample(ncol(socio),n_bill_sample,replace=FALSE)
bill_sample_data<-tmp_bills[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are
visweb(socio[,match(bill_sample_data$billnum,colnames(socio))]
       #,type="none" #nested sorted by row/colSums,#diagonal highest # of interactiosn appear in diagonal
       ,labsize=2
       )
```

**Bipartite graph: Splitting bills by sponsoring party**

**Democrat sponsored bill**

* 25 randomly drawn (democrat sponsored) bills, all senators 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
n_sample_bills1<-25
n_sample_bills2<-25
#color the edges by partisanship of senator, and to create two separate plots all with all senators, one with bills sponsored by dems, and another with bills sponsored by reps. Then you can create the same plots but colored by membership of bills
#bills sponsored by Dems
dem_socio<-socio[,match(tmp_bills$billnum[which(tmp_bills$billsponsor_party=="Democrat")],colnames(socio))] #cols of socio for democrat bills
  #sample from the bills
  set.seed(6102020)
  bill_sample<-sample(colnames(dem_socio),n_sample_bills1,replace=FALSE)
  dem_bill_sample_data<-tmp_bills[which(tmp_bills$billnum%in%bill_sample),]
rep_socio<-socio[,match(tmp_bills$billnum[which(tmp_bills$billsponsor_party=="Republican")],colnames(socio))] #cols of socio for republican bills
  #sample from the bills
  set.seed(6102020)
  bill_sample<-sample(colnames(rep_socio),n_sample_bills2,replace=FALSE)
  rep_bill_sample_data<-tmp_bills[which(tmp_bills$billnum%in%bill_sample),]
#Democrat-Sponsored Bills
plotwebB(dem_socio[,match(dem_bill_sample_data$billnum,colnames(dem_socio))],bor.col.interaction ="white"
        , text.high.col="dodgerblue1" #All BLUE
        , text.low.col=tmp_senate$low_senators_col
        ,method="cca"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        ,party_color_info=data.frame(name=senate$labels,party=senate$party)
        )
#bipartite_col_20dembills.pdf
```

**Republican sponsored bill**

* 25 randomly drawn (republican sponsored) bills, all senators 

```{r,echo=FALSE,eval=TRUE,warning=FALSE,message=FALSE}
#Republican-Sponsored Bills
plotwebB(rep_socio[,match(rep_bill_sample_data$billnum,colnames(rep_socio))]
        , text.high.col="firebrick1" #All RED
        , text.low.col=tmp_senate$low_senators_col
        ,method="normal"#,arrow="both", y.width.low=0.05
        ,empty="FALSE"#should empty cols/rows be omitted
        ,y.width.high=0.05,y.width.low=0.05
        ,col.interaction="grey80"
        ,low.lablength=10 #length of char senator names
        ,text.rot=90
        ,party_color_info=data.frame(name=senate$labels,party=senate$party)
        )
#bipartite_col_20repbills.pdf
#party<-ifelse(senate$party=="Republican",1,0)
#model$`MixedMembership 1`%*%party
#bill_party<-ifelse(bills$billsponsor_party=="Republican",1,0)
#model$`MixedMembership 2`%*%bill_party
```


<!-- # Comparing Congresses -->

<!-- ## Comparing group memberships -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- dyad.data107<-readRDS("cosponsor_data/dyad-data-107.rds") -->
<!-- senate107<-readRDS("cosponsor_data/senate-107.rds") -->
<!-- bills107<-readRDS("cosponsor_data/bills-107.rds") -->
<!-- dyad.data108<-readRDS("cosponsor_data/dyad-data-108.rds") -->
<!-- senate108<-readRDS("cosponsor_data/senate-108.rds") -->
<!-- bills108<-readRDS("cosponsor_data/bills-108.rds") -->
<!-- model107<-readRDS("congress107results/comodel-k34_B.rds") -->
<!-- model107$`MixedMembership 1`<-model107$`MixedMembership 1`[c(3,2,1),] -->
<!-- #do the same for Blockmodel -->
<!-- model107$BlockModel<-model107$BlockModel[c(3,2,1),] -->
<!-- #do the same for MonadCoef1 -->
<!-- model107$MonadCoef1<-model107$MonadCoef1[,c(3,2,1),] -->
<!-- colnames(model107$MonadCoef1)<-c("Group 1","Group 2","Group 3") -->
<!-- model108<-readRDS("congress108results/comodel-k22_B.rds") -->
<!-- ``` -->


<!-- **Comparing Group Membership Plots** -->
<!-- ```{r,echo=FALSE,eval=FALSE, fig.show="hold", out.width="50%"} -->
<!-- #par(mar = c(4, 4, .1, .1)) -->
<!-- plot.mmsbmB(model107,type="block") -->
<!-- plot.mmsbmB(model108,type="block") -->
<!-- #mtext("Left: Congress 107, Right: Congress 108", side=1, outer=TRUE, line=-3)  -->
<!-- #dev.off() -->
<!-- ``` -->

<!-- ```{r,echo=FALSE,eval=FALSE, fig.show="hold", out.width="50%"} -->
<!-- par(mar = c(4, 4, .1, .1)) -->
<!-- plot.mmsbmB(model107,type="groups") -->
<!-- plot.mmsbmB(model108,type="groups") -->
<!-- mtext("Left: Congress 107, Right: Congress 108", side=1, outer=TRUE, line=-3)  -->
<!-- dev.off() -->
<!-- ``` -->


<!-- ## Comparing Senator Predictors -->

<!-- **Senator Monadic Predictors** -->

<!-- * Session 107 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- coef107<-as.data.frame(model107$MonadCoef1) -->
<!-- colnames(coef107)<-c("Senate Group 1","Senate Group 2","Senate Group 3") -->
<!-- rownames(coef107)<-c("Intercept","Seniority","Ideol1","Ideol2","Republican","Male") -->
<!-- kable(coef107,digits=3) -->
<!-- ``` -->

<!-- * Session 108 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- coef108<-as.data.frame(model108$MonadCoef1[,,1]) -->
<!-- colnames(coef108)<-c("Senate Group 1","Senate Group 2") -->
<!-- rownames(coef108)<-c("Intercept","Seniority","Ideol1","Ideol2","Independent","Republican","Male") -->
<!-- kable(coef108,digits=3) -->
<!-- ``` -->

<!-- **Comparing Senator Ideology, Dimension 1** -->

<!-- * Session 107: Left -->
<!-- * Session 108: Right -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 11, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="ideol1",family=1) -->
<!-- covGroupB(fm=model108,cov="ideol1",family=1) -->
<!-- dev.off() -->
<!-- ``` -->


<!-- **Comparing Senator Party** -->

<!-- * Session 107: Left -->
<!-- * Session 108: Right -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="as.factor(party)",family=1) -->
<!-- covGroupB(fm=model108,cov="as.factor(party)",family=1) -->
<!-- dev.off() -->
<!-- ``` -->

<!-- **Comparing Senator Sex** -->

<!-- * Session 107: Left -->
<!-- * Session 108: Right -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="sex",family=1) -->
<!-- covGroupB(fm=model108,cov="sex",family=1) -->
<!-- dev.off() -->
<!-- ``` -->


<!-- ## Comparing Bills predictors -->

<!-- **Comparing Bills Monadic Predictors** -->

<!-- * Session 107 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- coef107<-as.data.frame(model107$MonadCoef2[,,1]) -->
<!-- colnames(coef107)<-c("Bills Group 1","Bills Group 2","Bills Group 3","Group 4") -->
<!-- rownames(coef107)<-c("Intercept","Major2:2","Major2:3","Major2:4","Major2:5","Major2:6" -->
<!--                    ,"Sponsor Seniority","Sponsor Ideol1","Sponsor Ideol2","Sponsor Republican","Male") -->
<!-- kable(coef107,digits=3) -->
<!-- ``` -->

<!-- * Session 108 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- coef108<-as.data.frame(model$MonadCoef2[,,1]) -->
<!-- colnames(coef108)<-c("Bills Group 1","Bills Group 2") -->
<!-- rownames(coef108)<-c("Intercept","Major2:2","Major2:3","Major2:4","Major2:5","Major2:6" -->
<!--                    ,"Sponsor Seniority","Sponsor Ideol1","Sponsor Ideol2","Sponsor Independent","Sponsor Republican","Male") -->
<!-- kable(coef108,digits=3) -->
<!-- ``` -->

<!-- **Comparing Bills Major Category classification** -->

<!-- Recall: -->

<!-- * `Major2`: crude categories of type of bill, where -->
<!--   - 1 = Economy (1=Macro, 4=Agriculture, 5=Labor,8=Energy,15=Domestic Commerce,17=Tech,18=Foreign Trade,19=International),  -->
<!--   - 2 = Legal (2=Civil Rights,9=Immigration,12=Law&Crime) -->
<!--   - 3 = Social programs/Public goods (3=Health,6=Education,7=Environment, 10=Transportation,13=Social Welfare,14=Housing, 21=Public lands,23=Culture) -->
<!--   - 4 = Security (16=Defense) -->
<!--   - 5 = Gov operations (20=Gov operations) -->
<!--   - 6 = Other (all others) -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="as.factor(Major2)",family=2, groupassign="expected") -->
<!-- covGroupB(fm=model108,cov="as.factor(Major2)",family=2, groupassign="expected") -->
<!-- dev.off() -->
<!-- ``` -->

<!-- **Comparing Bills Sponsor Ideology, Dimension 1** -->

<!-- * Session 107: Left -->
<!-- * Session 108: Right -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="billsponsor_ideol1",family=2, groupassign="expected") -->
<!-- covGroupB(fm=model108,cov="billsponsor_ideol1",family=2, groupassign="expected") -->
<!-- dev.off() -->
<!-- ``` -->


<!-- **Comparing Bills Sponsor Party** -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- par(mfrow=c(1,2)) -->
<!-- covGroupB(fm=model107,cov="billsponsor_party",family=2, groupassign="expected") -->
<!-- covGroupB(fm=model108,cov="billsponsor_party",family=2, groupassign="expected") -->
<!-- dev.off() -->
<!-- ``` -->


<!-- ## Comparing bipartite graphs -->

<!-- **Degree distribution of full bipartite** -->

<!-- * Session 107 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- socio107<-readRDS("congress107results/sociomatrix_ideolorder.rds") -->
<!-- degree.s.n <- (rowSums(as.matrix(socio107)))/dim(as.matrix(socio107))[2] # degree for the first node set. -->
<!-- tmp<-degree.s.n%*% t(model107$`MixedMembership 1`) -->
<!-- colnames(tmp)<-c("group 1", "group 2", "group 3") -->
<!-- kable(tmp,caption="107 Senators: Degree for each group",digits=2) -->
<!-- degree.s.m <- (colSums(as.matrix(socio107)))/dim(as.matrix(socio107))[1] # degree for the second node set. -->
<!-- tmp<-degree.s.m%*% t(model107$`MixedMembership 2`) -->
<!-- colnames(tmp)<-c("group 1", "group 2", "group 3","group 4") -->
<!-- kable(tmp,caption="107 Bills: Degree for each group",digits=2) -->
<!-- ## -->
<!-- ``` -->

<!-- * Session 108 -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- socio108<-readRDS("congress108results/sociomatrix_ideolorder.rds") -->
<!-- degree.s.n <- (rowSums(as.matrix(socio108)))/dim(as.matrix(socio108))[2] # degree for the first node set. -->
<!-- tmp<-degree.s.n%*% t(model108$`MixedMembership 1`) -->
<!-- colnames(tmp)<-c("group 1", "group 2") -->
<!-- kable(tmp,caption="108 Senators: Degree for each group",digits=2) -->
<!-- degree.s.m <- (colSums(as.matrix(socio108)))/dim(as.matrix(socio108))[1] # degree for the second node set. -->
<!-- tmp<-degree.s.m%*% t(model108$`MixedMembership 2`) -->
<!-- colnames(tmp)<-c("group 1", "group 2") -->
<!-- kable(tmp,caption="108 Bills: Degree for each group",digits=2) -->
<!-- ## -->
<!-- ``` -->

<!-- **Comparing bipartite graph visualizations** -->

<!-- * 200 randomly drawn bills, all senators -->
<!-- * Bill labels are sorted ideology most negative on L (liberal) and most positive on R (conservative) -->
<!-- * Colored in "blue" for Democrat sponsored, and "red" for Republican sponsored -->
<!-- * Senators sorted by ideology as well Left to Right and colored by their party ID.  -->
<!-- * Edges colored in bill sponsor party -->

<!-- **Session 107** -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- n_bill_sample<-200 -->
<!-- tmp_senate107<-senate107[order(senate107$ideol1),] -->
<!-- tmp_bills107<-bills107[order(bills107$billsponsor_ideol1),] -->
<!-- #higher=col=bills,lower=row=senators -->
<!-- tmp_bills107$high_bills_col<-ifelse(tmp_bills107$billsponsor_party=="Democrat","dodgerblue1","firebrick2") -->
<!-- tmp_senate107$low_senators_col<-ifelse(tmp_senate107$party=="Democrat","dodgerblue1","firebrick2") -->
<!-- set.seed(6102020) -->
<!-- bill_sample<-sample(ncol(socio107),n_bill_sample,replace=FALSE) -->
<!-- bill_sample_data<-tmp_bills107[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio107 are -->
<!-- bill_sample_data<-bill_sample_data[order(bill_sample_data$billsponsor_ideol1),] -->

<!-- plot1<-plotwebB(socio107[,match(bill_sample_data$billnum,colnames(socio107))] -->
<!--                 , text.high.col=bill_sample_data$high_bills_col -->
<!--         , text.low.col=tmp_senate107$low_senators_col -->
<!--         ,method="cca"#,arrow="both", y.width.low=0.05 -->
<!--         ,empty="FALSE"#should empty cols/rows be omitted -->
<!--         ,y.width.high=0.05,y.width.low=0.05 -->
<!--         ,col.interaction="grey80" -->
<!--         ,low.lablength=10 #length of char senator names -->
<!--         ,text.rot=90 -->
<!--         #,party_color_info=data.frame(name=tmp_senate107$labels,party=tmp_senate107$party) -->
<!--         ,bills_color_info=data.frame(name=bill_sample_data$billnum, party=bill_sample_data$billsponsor_party) -->
<!--         ) -->
<!-- plot1 -->
<!-- ``` -->

<!-- **Session 108** -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE, fig.height = 7, fig.width = 10, fig.align = "center"} -->
<!-- n_bill_sample<-200 -->
<!-- tmp_senate<-senate108[order(senate108$ideol1),] -->
<!-- tmp_bills<-bills108[order(bills108$billsponsor_ideol1),] -->
<!-- tmp_bills$high_bills_col<-ifelse(tmp_bills$billsponsor_party=="Democrat","dodgerblue1",ifelse(tmp_bills$billsponsor_party=="Republican","firebrick2","gray")) -->
<!-- tmp_senate$low_senators_col<-ifelse(tmp_senate$party=="Democrat","dodgerblue1",ifelse(tmp_senate$party=="Republican","firebrick2","gray")) -->
<!-- set.seed(6102020) -->
<!-- bill_sample<-sample(ncol(socio108),n_bill_sample,replace=FALSE) -->
<!-- bill_sample_data<-tmp_bills[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are -->
<!-- bill_sample_data<-bill_sample_data[order(bill_sample_data$billsponsor_ideol1),] -->

<!-- plot2<-plotwebB(socio[,match(bill_sample_data$billnum,colnames(socio108))] -->
<!--          ,text.high.col=bill_sample_data$high_bills_col -->
<!--         , text.low.col = tmp_senate$low_senators_col -->
<!--         ,method="normal"#,arrow="both", y.width.low=0.05 -->
<!--         ,empty="FALSE"#should empty cols/rows be omitted -->
<!--         ,y.width.high=0.05,y.width.low=0.05 -->
<!--         ,col.interaction="grey80" -->
<!--         ,low.lablength=10 #length of char senator names -->
<!--         ,text.rot=90 -->
<!--         #,party_color_info=data.frame(name=tmp_senate108$labels,party=tmp_senate108$party) -->
<!--         ,bills_color_info=data.frame(name=bill_sample_data$billnum,party=bill_sample_data$billsponsor_party) -->
<!--         ) -->
<!-- #bipartite_col_25bills.pdf -->
<!-- plot2 -->
<!-- ``` -->

<!-- **Bipartite sociomatrix visualization:** -->

<!-- * Senator rows -->
<!-- * Bill columns (random draw of 100) -->
<!-- * sorted by row/colSums -->

<!-- [Session 107]{color="red"} -->


<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- n_bill_sample<-100 -->
<!-- set.seed(6102020) -->
<!-- tmp_bills107<-bills107[order(bills107$billsponsor_ideol1),] -->
<!-- bill_sample<-sample(ncol(socio107),n_bill_sample,replace=FALSE) -->
<!-- bill_sample_data<-tmp_bills107[bill_sample,] #works only if tmp_bills107 rows ordered in same way cols of socio are -->
<!-- visweb(socio107[,match(bill_sample_data$billnum,colnames(socio107))] -->
<!--        #,type="none" #nested sorted by row/colSums,#diagonal highest # of interactiosn appear in diagonal -->
<!--        ,labsize=2 -->
<!--        ) -->
<!-- ``` -->

<!-- [Session 108]{color="red"} -->

<!-- ```{r,echo=FALSE,eval=FALSE,warning=FALSE,message=FALSE} -->
<!-- n_bill_sample<-100 -->
<!-- set.seed(6102020) -->
<!-- tmp_bills108<-bills108[order(bills108$billsponsor_ideol1),] -->
<!-- bill_sample<-sample(ncol(socio108),n_bill_sample,replace=FALSE) -->
<!-- bill_sample_data<-tmp_bills108[bill_sample,] #works only if tmp_bills rows ordered in same way cols of socio are -->
<!-- visweb(socio108[,match(bill_sample_data$billnum,colnames(socio108))] -->
<!--        #,type="none" #nested sorted by row/colSums,#diagonal highest # of interactiosn appear in diagonal -->
<!--        ,labsize=2 -->
<!--        ) -->
<!-- ``` -->

# Notes

9/21/2020
* reciprocity variable: code dummy for 0; another variable that's log(reciprocity +1) --> change this to proportion (den total sponsored bills) (if still super skewed, below:)
* reciprocity more on dyadic measurement of reciprocity -- net of that, likelihood of senators cosponsoring together
* change covariates and see how it affects small world network:
  - estimate model, create 100 replicates of network and compute the small network statistics, see how it changes
* Simulate a bunch of networks, and of those networks compute small world and then 
  - each legislator generate membership, given that membership use block model probas to generate the networks (holding covariates at meaningful level)
* network~network ; impossible bc a change in the network hard to think of, so hard to focus on what shifting; so instead summarize network using a model; then think of changing of parameter of model, which changes distrib of network and use that on the network
  - averaging units across time -- (Neil Sheppard) --> martingale trick to get variance over time even if things are dependent, use that to get standard error; so treatment is a map of a day, outcome is map of a day; then you can allow arbitrary spillover effects
  - network spillover: if I change the network of this congress, what is the causal effect of that on next congress (with standard errors)
  - SO: how is result not entirely based on model you choose? KI: in obs study still need to model treatment, so there's modeling assumption. but the nice bit of above, subtle diff in assuming how people react to text is fn of model parameter directly (unreasonable) whereas implied
  
  
## Application notes

* Match on Senator latent groups via largest proportion of Party (so latent group mostly Republicans, mostly Democrats, and mixed -- matched labels for sessions 107-108)
* Session 107 model output, Senator latent groups are

* Session 108 model output, Senator latent groups are
  - Group 1 D
  - Group 2 R
  
  
* would be helpful to have some measure of how "contentious" a bill is, as well as how "symbolic" -- since likely that directly relates to how many cosponsors (right now bills tend to group into "high degree", "mid degree", "very low degree")


## Theory notes

* 2 models identical forms (cosponsor/sponsor decisions): can be modeled separately; founders and joiners
  - connect the two by having the same latent membership for organization -- only thing that connects the two; once you condition on that, you can update each model separately
  - only diff is when update latent group membership of organizations you bring info from both models
  - two sets of dyads fine for sponsors/cosponsors update; updates of phis for bills would draw from info from both networks
  - every dyad that involves the same bill updateable;
  
## To do

How to compare with unipartite set up?
* block model senators under bipartite and unipartite 
* predictive accuracy?
* simulation of bipartite --> and analyze with unipartite projection

Create Table 1 from "Fast Estimation of Ideal Points with massive Data" 
Conjoint.pdf for imai.fas.harvard.edu/research/files/conjoint.pdf Figure 1

no. nodes in each type and no. nodes end up using -- ignoring thousands of types of data; 

* bill is a path through which legislators are connected -- then you lose the ability to say this is the reason why these legislators are connect -- connect because connect through diff types of bills
* even if you only care about relationships between legis by ignoring bills lose your ability to say what about bills that makes legislators work together
* lose ability to discern across types of bills


Interpreting the dyadic coefficient `lreciprocity_prop`
* 1% incr in reciprocity leads to 2% increase in odds of cosponsoring
* probability of reciprocity: if you go from quarter time to half the time

In Song's model
* requires repeated interactions between same pair of nodes -- some edges are allowed to be of different kinds
* graph where he has collapsed  